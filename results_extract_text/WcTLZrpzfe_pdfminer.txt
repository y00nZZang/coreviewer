Under review as a conference paper at ICLR 2023

PROTEIN STRUCTURE REPRESENTATION LEARNING
THROUGH ORIENTATION-AWARE GRAPH NEURAL
NETWORKS

Anonymous authors
Paper under double-blind review

ABSTRACT

By folding to particular 3D structures, proteins play a key role in living beings.
To learn meaningful representation from a protein structure for downstream tasks,
not only the global backbone topology but the local fine-grained orientational re-
lations between amino acids should also be considered.
In this work, we pro-
pose the Orientation-Aware Graph Neural Networks (OAGNNs) to better sense
the geometric characteristics in protein structure (e.g.
inner-residue torsion an-
gles, inter-residue orientations). Extending a single weight from a scalar to a
3D vector, we construct a rich set of geometric-meaningful operations to pro-
cess both the classical and SO(3) representations of a given structure. To plug
our designed perceptron unit into existing Graph Neural Networks, we further
introduce an equivariant message passing paradigm, showing superior versatility
in maintaining SO(3)-equivariance at the global scale. Experiments have shown
that our OAGNNs have a remarkable ability to sense geometric orientational fea-
tures compared to classical networks. OAGNNs have also achieved state-of-the-
art performance on various computational biology applications related to protein
3D structures.

1

INTRODUCTION

Built from a sequence of amino-acid residues, a protein performs its biological functions by folding
to a particular conformation in 3D space. Therefore, untilizing such 3D structures accurately is the
key for downstream analysis. While we have witnessed remarkable progress in protein structure
predictions (Rohl et al., 2004; K¨allberg et al., 2012; Baek et al., 2021; Jumper et al., 2021), another
thread of tasks with protein 3D structures as input starts to draw a great interest, such as function
prediction (Hermosilla et al., 2020; Gligorijevi´c et al., 2021), decoy ranking (Lundstr¨om et al., 2001;
Kwon et al., 2021; Wang et al., 2021), protein docking (Duhovny et al., 2002; Shulman-Peleg et al.,
2004; Gainza et al., 2020; Sverrisson et al., 2021), and driver mutation identification (Lef`evre et al.,
1997; Antikainen & Martin, 2005; Li et al., 2020; Jankauskait˙e et al., 2019).

Most existing works in modeling protein structures directly borrow models designed for other ap-
plications, including 3D-CNNs (Ji et al., 2012) in computer vision, Transformers (Vaswani et al.,
2017)) from natural language processing, and GNNs (Kipf & Welling, 2016) in data mining. Though
compatible with general objects, these models have overlooked the subtleties in the fine-grained ge-
ometries, which are much more essential in protein structures. For instance, given an amino acid in
the protein structure, as shown in Figure 1, the locations of four backbone atoms (carbon, nitrogen,
and oxygen) determine a local skeleton, and different residues interact with each other through per-
forming specific orientations between their local frames, either of which have important impacts on
the protein structure and its function (Nelson et al., 2008).

Recent attempts in building geometric-aware neural networks mainly focus on baking 3D rigid
transformations into network operations, leading to the area of SO(3)-invariant and equivariant
networks. One representative work is the Vector Neuron Network (VNN) (Deng et al., 2021), which
achieves SO(3)-equivariance on point clouds by generalizing scalar neurons to 3D vectors. An-
other work is the GVP-GNN (Jing et al., 2021) that similarly vectorizes hidden neurons in GNN and
demonstrates better prediction accuracy on protein design and quality evaluation tasks. However,

1

Under review as a conference paper at ICLR 2023

Figure 1: Overview (a) Each amino acid has its own rigid backbone with four heavy atoms, and
can be represented by both lists of scalar and vector features. (b) Tasks associated with the protein
3D structure. Graph-level tasks consider the whole protein structures, and Node-level tasks operate
on specific residues.

these two models can only adopt linear combinations of input vectors, which significantly limits
their modeling capability. A simple example is that, given two input vector features v1 and v2, the
outputs w1v1 + w2v2 through one linear layer is constrained in the 2D plane spanned by v1, v2
even after applying their scalar-product non-linearities. That is, VNN-based models are limited in
perceiving orientational features, which have been proven crucial for proteins to perform their func-
tions and interact with other partners (e.g. inner-residue torsion angles, inter-residue orientations)
(Nelson et al., 2008; Voet & Voet, 2010; Xu & Berger, 2006; Alford et al., 2017).

To achieve more sensitive geometric orientation awareness, we propose a Directed Weight ( ⃗W) per-
ceptrons by extending not only the hidden neurons but also the weights from scalars to 3D vectors,
naturally saturating the entire network with 3D structure information in the Euclidean space. Di-
rected weights support a set of geometric-meaningful operations on both the vector neurons (vector-
list features) and the classical (scalar-list) latent features, and perform flexible non-linear integration
of the hybrid scalar-vector features. As protein structures are naturally attributed proximity graphs,
we introduce a new Equivariant Message Passing Paradigm on protein graphs, to connect the ⃗W-
perceptrons with the graph learning models by using rigid backbone transformations for each amino
acid, which provides a versatile framework for bringing the biological suitability and flexibility of
the GNN architecture.

To summarize, our key contributions include:

• We propose a new network unit based on the Directed Weights for capturing fine-grained

geometric relations, especially for the subtle orientational details in proteins.

• We construct an Equivariant Message Passing paradigm based on protein graphs.
• Our overall framework, the Orientation-Aware Graph Neural Networks, is versatile in
terms of compatibility with existing deep graph learning models, making them biologically
suitable with minimal modifications to existing GNN models.

2 RELATED WORK

Representation learning on protein 3D structure. Early approaches rely on hand-crafted fea-
tures extracted and statistical methods to predict function annotations (Schaap et al., 2001; Zhang &
Zhang, 2010). Deep learning has been found to achieve success then. 3D CNNs are first proposed to
process protein 3D structures by scanning atom-level features relying on multiple 3D voxels. One of
the representative works (Derevyanko et al., 2018) adopts a 3D CNN-based model for assessing the
quality of the predicted structures. 3D CNNs also shed light on other tasks such as interface predic-
tion (Townshend et al., 2019; Amidi et al., 2018). People also extend them to spherical convolutions
(Gainza et al., 2020; Sverrisson et al., 2021; Hermosilla Casajus et al., 2021), to the Fourier space
(Zhemchuzhnikov et al., 2022) and the 3D Voronoi Tessellation space (Igashov et al., 2021). Graph
Convolutional Networks (Kipf & Welling, 2016) have also been adopted to capture geometric and
biochemical interactions between residues (Ying et al., 2018; Gao & Ji, 2019; Fout, 2017), and have
been shown to achieve great performance on function prediction (Li et al., 2021), protein design
(Strokach et al., 2020) and binding prediction (Vecchio et al., 2021). Recently, transformer-based

2

Under review as a conference paper at ICLR 2023

methods (Vaswani et al., 2017) have a trend to replace conventional methods in other bioinformatics
tasks (Ingraham et al., 2019; Baek et al., 2021; Jumper et al., 2021; Cao et al., 2021).

Equivariant neural networks. Equivariance is an important property, for generalizing to unseen
conditions in geometric learning. (Cohen & Welling, 2016; Weiler et al., 2018; K¨ohler et al., 2020;
Satorras et al., 2021; Thomas et al., 2018; Fuchs et al., 2020; Anderson et al., 2019; Gasteiger et al.,
2019b; Batzner et al., 2021; Eismann et al., 2021). Methods such as Tensor Field Network (Thomas
et al., 2018) and Cormorant (Anderson et al., 2019), have been developed to generate irreducible
representations for achieving rotation equivariance in 3D. In comparison to Tensor Filed Network
with complex tensor products, the Vector Neuron Network (VNN) achieves rotation equivariance
in a much simpler way, which generalizes the values of hidden neurons from scalars to 3D vectors
(Deng et al., 2021). GVP-GNN has also been introduced for learning protein representations by
featuring geometric factors as vectors (Jing et al., 2020). Message passing in GNNs for vector
representations using equivariant features have also been explored (Sch¨utt et al., 2021; Luo et al.,
2022). However, to guarantee rotation equivariance, they can only linearly combine 3D vectors, in
essence, limiting their geometric representing capacity. Another line of methods condition filters on
invariant scalar features for maitaining equivariance (Sch¨utt et al., 2017; Gasteiger et al., 2019a; Liu
et al., 2021).

3 DIRECTED WEIGHT PERCEPTRON

Figure 2: Model Details. A 1-layer DWP consists of three following modules. Both the input,
hidden and output are tuples. (a) Directed Linear Module applies multiple geometric operations
to update scalar and vector features in four different ways with normal and directed weights. (b)
Non-Linearity Module employs ReLU and sigmoid functions for scalar and vector features. (c)
Directed Interaction Module updates the features by using one another as updating parameters
after non-linearity in another way.

,

= (

) where each node u

corresponds to one
A protein is modeled as a KNN-graph
E
G
∈ V
3,
RC, Vu ∈
amino acid, characterized by a scalar-vector tuple hu = (su, Vu) with su ∈
and the edges are constructed spatially by querying its k-nearest neighbours in the space. The edge
features
=j, which represent edge connected node i and j, are also multi-channel scalar-
vector tuples. For simplicity, we set the channel numbers for scalar and vector features as the same,
but they can be different. In practice, scalar, vector features are constructed based on a given protein
structure and are kept separate. To make them compatible, the channel numbers of scalars are larger
than the vectors. Details can be found in the Appendix Section B.1.

eij}i
{

RC

=

V

E

×

3.1 DIRECTED WEIGHTS

Classical neural networks only consider scalar-list features of the form s
transforming them with a weight matrix W

C and a bias term b

RC, with each layer

∈
RC′:

∈

×

∈

RC′
s′ = Ws + b

(1)

Although has been proved to be a universal approximator, such a layer has intrinsically no geometric
interpretation in the 3D shape space, and even the simplest 3D rigid transformation on the input can
result in unpredictable changes of network outputs. Recent attempts have lifted neuron features from

3

Vector-Tensor MatMulMatMulVector-Vector Cross ProductVector FeaturesScalar FeaturesWeightDirected WeightVector featuresScalar features<latexit sha1_base64="FdO3Xhrf2VZ4IhTZW2J0Qwx+Xkg=">AAACDnicbZDLSsNAFIYn9VbrLSqu3AwWoYKURIq6LHbjsoK9QBvCZDJph85MwsxEKKHv4Cu41b07cesruPVJnLYRtPWHAx//OYdz+IOEUaUd59MqrKyurW8UN0tb2zu7e/b+QVvFqcSkhWMWy26AFGFUkJammpFuIgniASOdYNSY9jsPRCoai3s9TojH0UDQiGKkjeXbR2Gl4fcRS4boHP7QmW+XnaozE1wGN4cyyNX07a9+GOOUE6ExQ0r1XCfRXoakppiRSamfKpIgPEID0jMoECfKy2bvT+CpcUIYxdKU0HDm/t7IEFdqzAMzyZEeqsXe1Py3F/CFyzq69jIqklQTgeeHo5RBHcNpNjCkkmDNxgYQltT8DvEQSYS1SbBkQnEXI1iG9kXVvazW7mrl+k0eTxEcgxNQAS64AnVwC5qgBTDIwBN4Bi/Wo/VqvVnv89GCle8cgj+yPr4BI5WbNQ==</latexit>d(C↵,C↵)<latexit sha1_base64="xRFvcCAHe3sdZK6o49MLG0zyJbM=">AAAB6nicbVBNS8NAEJ3Ur1q/qh69LBbBU0lE1GPRi8eK9gPaUDbbSbt0swm7m0IJ/QlePCji1V/kzX/jts1BWx8MPN6bYWZekAiujet+O4W19Y3NreJ2aWd3b/+gfHjU1HGqGDZYLGLVDqhGwSU2DDcC24lCGgUCW8Hobua3xqg0j+WTmSToR3QgecgZNVZ6HPe8XrniVt05yCrxclKBHPVe+avbj1kaoTRMUK07npsYP6PKcCZwWuqmGhPKRnSAHUsljVD72fzUKTmzSp+EsbIlDZmrvycyGmk9iQLbGVEz1MveTPzP66QmvPEzLpPUoGSLRWEqiInJ7G/S5wqZERNLKFPc3krYkCrKjE2nZEPwll9eJc2LqndVvXy4rNRu8ziKcAKncA4eXEMN7qEODWAwgGd4hTdHOC/Ou/OxaC04+cwx/IHz+QMLko2n</latexit>v1<latexit sha1_base64="pd6CG+fgXjPa9TrI/+SvifD5VxY=">AAAB6nicbVDLTgJBEOzFF+IL9ehlIjHxRHYJUY9ELx4xyiOBDZkdemHC7OxmZpaEED7BiweN8eoXefNvHGAPClbSSaWqO91dQSK4Nq777eQ2Nre2d/K7hb39g8Oj4vFJU8epYthgsYhVO6AaBZfYMNwIbCcKaRQIbAWju7nfGqPSPJZPZpKgH9GB5CFn1Fjpcdyr9Iolt+wuQNaJl5ESZKj3il/dfszSCKVhgmrd8dzE+FOqDGcCZ4VuqjGhbEQH2LFU0gi1P12cOiMXVumTMFa2pCEL9ffElEZaT6LAdkbUDPWqNxf/8zqpCW/8KZdJalCy5aIwFcTEZP436XOFzIiJJZQpbm8lbEgVZcamU7AheKsvr5NmpexdlasP1VLtNosjD2dwDpfgwTXU4B7q0AAGA3iGV3hzhPPivDsfy9ack82cwh84nz8NFo2o</latexit>v2<latexit sha1_base64="r71G5bfv7Z+tz9k6HJIJFY4XQOM=">AAAB+3icbVDLSsNAFL2pr1pfVZduBovgqiRSqsuiG5cV7APaUCbTSTN0ZhJmJkIJ/QW3uncnbv0Yt36JkzYLbT1w4XDOvZzLCRLOtHHdL6e0sbm1vVPereztHxweVY9PujpOFaEdEvNY9QOsKWeSdgwznPYTRbEIOO0F07vc7z1RpVksH80sob7AE8lCRrDJpWESsVG15tbdBdA68QpSgwLtUfV7OI5JKqg0hGOtB56bGD/DyjDC6bwyTDVNMJniCR1YKrGg2s8Wv87RhVXGKIyVHWnQQv19kWGh9UwEdlNgE+lVLxf/9QKxkmzCGz9jMkkNlWQZHKYcmRjlRaAxU5QYPrMEE8Xs74hEWGFibF0VW4q3WsE66V7VvWa98dCotW6LespwBudwCR5cQwvuoQ0dIBDBM7zAqzN33px352O5WnKKm1P4A+fzB2EelO4=</latexit> (c) Directed InteractionHidden featuresInput features(a) Directed Linear(b) Non-Linearity<latexit sha1_base64="HCWYwa4Y2ORmFSOCBNJWMc7r4K0=">AAAB/HicbVBNS8NAFHypX7V+VT16WSyCp5JIUY8FLx4rmLbShrLZbNqlu9mwuxFKqH/Bq969iVf/i1d/ids2B20deDDMvMc8Jkw508Z1v5zS2vrG5lZ5u7Kzu7d/UD08amuZKUJ9IrlU3RBryllCfcMMp91UUSxCTjvh+Gbmdx6p0kwm92aS0kDgYcJiRrCxkt+XkTSDas2tu3OgVeIVpAYFWoPqdz+SJBM0MYRjrXuem5ogx8owwum00s80TTEZ4yHtWZpgQXWQz5+dojOrRCiWyk5i0Fz9fZFjofVEhHZTYDPSy95M/NcLxVKyia+DnCVpZmhCFsFxxpGRaNYEipiixPCJJZgoZn9HZIQVJsb2VbGleMsVrJL2Rd27rDfuGrXmQ1FPGU7gFM7Bgytowi20wAcCDJ7hBV6dJ+fNeXc+Fqslp7g5hj9wPn8AR06VhA==</latexit> <latexit sha1_base64="1E80okeQO5A7dqhHWEWGxdqjJjs=">AAAB/XicbVC7SgNBFL0bXzG+opY2g0GwCrsiahmwsYxgHpIsYXYym4yZxzIzK4Ql+Au22tuJrd9i65c4SbbQxAMXDufcy7mcKOHMWN//8gorq2vrG8XN0tb2zu5eef+gaVSqCW0QxZVuR9hQziRtWGY5bSeaYhFx2opG11O/9Ui1YUre2XFCQ4EHksWMYOukZlclPDW9csWv+jOgZRLkpAI56r3yd7evSCqotIRjYzqBn9gww9oywumk1E0NTTAZ4QHtOCqxoCbMZt9O0IlT+ihW2o20aKb+vsiwMGYsIrcpsB2aRW8q/utFYiHZxldhxmSSWirJPDhOObIKTatAfaYpsXzsCCaaud8RGWKNiXWFlVwpwWIFy6R5Vg0uque355XafV5PEY7gGE4hgEuowQ3UoQEEHuAZXuDVe/LevHfvY75a8PKbQ/gD7/MHM86WCw==</latexit> BiasScale<latexit sha1_base64="HCWYwa4Y2ORmFSOCBNJWMc7r4K0=">AAAB/HicbVBNS8NAFHypX7V+VT16WSyCp5JIUY8FLx4rmLbShrLZbNqlu9mwuxFKqH/Bq969iVf/i1d/ids2B20deDDMvMc8Jkw508Z1v5zS2vrG5lZ5u7Kzu7d/UD08amuZKUJ9IrlU3RBryllCfcMMp91UUSxCTjvh+Gbmdx6p0kwm92aS0kDgYcJiRrCxkt+XkTSDas2tu3OgVeIVpAYFWoPqdz+SJBM0MYRjrXuem5ogx8owwum00s80TTEZ4yHtWZpgQXWQz5+dojOrRCiWyk5i0Fz9fZFjofVEhHZTYDPSy95M/NcLxVKyia+DnCVpZmhCFsFxxpGRaNYEipiixPCJJZgoZn9HZIQVJsb2VbGleMsVrJL2Rd27rDfuGrXmQ1FPGU7gFM7Bgytowi20wAcCDJ7hBV6dJ+fNeXc+Fqslp7g5hj9wPn8AR06VhA==</latexit> <latexit sha1_base64="Vf1hjbmSH9wOw4kIawbUNidC/m0=">AAACBXicbVA9SwNBEN3zM8avU0stFoMQm3AnQS2DNpYRzAfkQtjb2yRL9m6P3TkxXNLY+FdsLBSx9T/Y+W/cJFdo4oOBx3szzMzzY8E1OM63tbS8srq2ntvIb25t7+zae/t1LRNFWY1KIVXTJ5oJHrEacBCsGStGQl+whj+4nviNe6Y0l9EdDGPWDkkv4l1OCRipYx95wB4g1bwXSh6McdEbYY8GErA3Ou3YBafkTIEXiZuRAspQ7dhfXiBpErIIqCBat1wnhnZKFHAq2DjvJZrFhA5Ij7UMjUjIdDudfjHGJ0YJcFcqUxHgqfp7IiWh1sPQN50hgb6e9ybif14rge5lO+VRnACL6GxRNxEYJJ5EggOuGAUxNIRQxc2tmPaJIhRMcHkTgjv/8iKpn5Xc81L5tlyoXGVx5NAhOkZF5KILVEE3qIpqiKJH9Ixe0Zv1ZL1Y79bHrHXJymYO0B9Ynz/2R5g4</latexit>sigmoid(k·k)<latexit sha1_base64="O+F2xZVXS3tr0R3hjT24+uHCi9Q=">AAAB+3icbVDLTgJBEJzFF+IL8ehlIzHBC9k1RD0SvXjwgMYFEtiQ2dlemDD7yEyvgWz4FS8eNMarP+LNv3F4HBSspJNKVXe6u7xEcIWW9W3k1tY3Nrfy24Wd3b39g+JhqaniVDJwWCxi2faoAsEjcJCjgHYigYaegJY3vJn6rSeQisfRI44TcEPaj3jAGUUt9YqlLsIIswe4cyaVLvNjPOsVy1bVmsFcJfaClMkCjV7xq+vHLA0hQiaoUh3bStDNqETOBEwK3VRBQtmQ9qGjaURDUG42u31inmrFN4NY6orQnKm/JzIaKjUOPd0ZUhyoZW8q/ud1Ugyu3IxHSYoQsfmiIBUmxuY0CNPnEhiKsSaUSa5vNdmASspQx1XQIdjLL6+S5nnVvqjW7mvl+vUijjw5JiekQmxySerkljSIQxgZkWfySt6MifFivBsf89acsZg5In9gfP4Ao+yUMA==</latexit>ReLU(·)Output features<latexit sha1_base64="L1UAsL34EM2ftdjCyvm5Nob35NE=">AAACGXicbVC7TsMwFHXKq5RXgJHFokJiqhKooGOlLowF0YfUhMp2ndaq7US2g1RFXfkJfoEVdjbEysTKl+C0HaBwJEtH59yrc31wwpk2nvfpFFZW19Y3ipulre2d3T13/6Ct41QR2iIxj1UXI005k7RlmOG0myiKBOa0g8eN3O/cU6VZLG/NJKGhQEPJIkaQsVLfhQEWWXsKAyZhIJAZYQxv7rJGYJigGp5P+27Zq3gzwL/EX5AyWKDZd7+CQUxSQaUhHGnd873EhBlShhFOp6Ug1TRBZIyGtGepRDYnzGY/mcITqwxgFCv7pIEz9edGhoTWE4HtZH6sXvZy8V8Pi6VkE9XCjMkkNVSSeXCUcmhimNcEB0xRYvjEEkQUs7dDMkIKEWPLLNlS/OUK/pL2WcW/qFSvq+V6bVFPERyBY3AKfHAJ6uAKNEELEPAAnsAzeHEenVfnzXmfjxacxc4h+AXn4xtTKKAi</latexit>V2RC⇥3<latexit sha1_base64="mOhQbIm7oYg3TPl6JCYYDaBoIlc=">AAACEXicbVDLSgMxFM34rPU16kZwEyyCqzIjRbssdOOyin1AZyxJmmlDk8yQZIQy1J/wF9zq3p249Qvc+iVm2i609cCFwzn3cu89OOFMG8/7clZW19Y3Ngtbxe2d3b199+CwpeNUEdokMY9VByNNOZO0aZjhtJMoigTmtI1H9dxvP1ClWSzvzDihoUADySJGkLFSzz0OsMj0BAZMwkAgM8QY3t5n9UnPLXllbwq4TPw5KYE5Gj33O+jHJBVUGsKR1l3fS0yYIWUY4XRSDFJNE0RGaEC7lkokqA6z6QcTeGaVPoxiZUsaOFV/T2RIaD0W2HbmR+pFLxf/9bBY2GyiapgxmaSGSjJbHKUcmhjm8cA+U5QYPrYEEcXs7ZAMkULE2BCLNhR/MYJl0roo+5flyk2lVKvO4ymAE3AKzoEPrkANXIMGaAICHsEzeAGvzpPz5rw7H7PWFWc+cwT+wPn8AZaCnR4=</latexit>s2RC<latexit sha1_base64="S0l/MxMh20d6zzF1qXMMpCXOfMg=">AAACMXicdZDNSgMxEMezftb6VfXoJVgET2VbW/Uo9OKxirWCuy7ZNNsGs8mSzCpl2VfxJXwFr3rvTbz6EmbbCio6EDL8/jPMzD9MBDfgumNnbn5hcWm5tFJeXVvf2KxsbV8ZlWrKulQJpa9DYpjgknWBg2DXiWYkDgXrhXftQu/dM224kpcwSpgfk4HkEacELAoqJ56ysuaDIRCt1UPmxQSGYZT18qCRY49LPCVhdpHfZm0PeMwMPsyDStWttVwbDezWir/ZwjPSwvUJcd0qmkUnqLx7fUXTmEmgghhzU3cT8DOigVPB8rKXGpYQekcG7Mamktg5fja5MMf7lvRxpLR9EvCEfu/ISGzMKA5tZbGt+a0V8E8tjH9NhujEz7hMUmCSTgdHqcCgcGEf7nPNKIiRTQjV3O6O6ZBoQsGaXLamfF2O/0+uGrX6Ua153qyeNmb2lNAu2kMHqI6O0Sk6Qx3URRQ9omf0gl6dJ2fsvDnv09I5Z9azg36E8/EJHWirjA==</latexit>  !W22RC⇥3<latexit sha1_base64="vdsQ0BROIt65BlWWyOK62c8pmhM=">AAACH3icbVC7TsMwFHXKq5RXgJHFouIxVUlVAWOlLowF0YfUhMpxndaq7US2g1RF+QN+gl9ghZ0NsXblS3DaDtByJEvnnnuvzvUJYkaVdpypVVhb39jcKm6Xdnb39g/sw6O2ihKJSQtHLJLdACnCqCAtTTUj3VgSxANGOsG4kfc7T0QqGokHPYmJz9FQ0JBipI3Ut889jvQoCNNOBj0q4LwM0vvsMW1ceJpyomAj69tlp+LMAFeJuyBlsECzb397gwgnnAiNGVKq5zqx9lMkNcWMZCUvUSRGeIyGpGeoQMbHT2f/yeCZUQYwjKR5QsOZ+nsjRVypCQ/MZH6uWu7l4r+9gC856/DGT6mIE00EnhuHCYM6gnlYcEAlwZpNDEFYUnM7xCMkEdYm0pIJxV2OYJW0qxX3qlK7q5Xr1UU8RXACTsElcME1qINb0AQtgMEzeAVv4N16sT6sT+trPlqwFjvH4A+s6Q/KyaML</latexit>W2RC0⇥C<latexit sha1_base64="v4zKfOBNSxdAdD5TFPor452uX9c=">AAACPHicdVBNSwMxEM36bf2qevQSLKKnsltb9VjoxWMV2wpuLdk02wazyZLMKmXZH+Sf8C941at4E6+ezbYVVHQg5PHeDG/mBbHgBlz32ZmZnZtfWFxaLqysrq1vFDe32kYlmrIWVULpy4AYJrhkLeAg2GWsGYkCwTrBTSPXO7dMG67kBYxi1o3IQPKQUwKW6hUbvrKy5oMhEK3VXepHBIZBmHaynpdhn0s8YYL0PLtOG/vYBx4xgxtf4DDrFUtuuebaqmC3nP/VGp4yNeyNGdctoWk1e8UXv69oEjEJVBBjrjw3hm5KNHAqWFbwE8NiQm/IgF1ZKIn16abjYzO8Z5k+DpW2TwIes98nUhIZM4oC25kvbn5rOfmnFkS/nCE86aZcxgkwSSfGYSIwKJwniftcMwpiZAGhmtvdMR0STSjYvAs2lK/L8f+gXSl7R+XqWbVUr0zjWUI7aBcdIA8dozo6RU3UQhTdo0f0hJ6dB+fVeXPeJ60zznRmG/0o5+MT4j6vQQ==</latexit>  !W12RC0⇥C⇥3<latexit sha1_base64="7t61wu6DhDfi3mKZc8AAdazPP40=">AAACIHicbVC7TsMwFHXKq5RXgJHFokJlqpKqAsZKXRgLog+pKZXtOq1Vx4lsB6mK8gn8BL/ACjsbYoSRL8FpM0DLkSyde+69OtcHR5wp7TifVmFtfWNzq7hd2tnd2z+wD486KowloW0S8lD2MFKUM0HbmmlOe5GkKMCcdvG0mfW7D1QqFoo7PYvoIEBjwXxGkDbS0K54AdIT7CfdFHpMwEWJk9v0PmlWoKdZQBVspkO77FSdOeAqcXNSBjlaQ/vbG4UkDqjQhCOl+q4T6UGCpGaE07TkxYpGiEzRmPYNFcj4DJL5h1J4ZpQR9ENpntBwrv7eSFCg1CzAZjK7Vy33MvHfHg6WnLV/NUiYiGJNBVkY+zGHOoRZWnDEJCWazwxBRDJzOyQTJBHRJtOSCcVdjmCVdGpV96Jav6mXG7U8niI4AafgHLjgEjTANWiBNiDgETyDF/BqPVlv1rv1sRgtWPnOMfgD6+sHLryjNQ==</latexit>W2RC0⇥C<latexit sha1_base64="vdsQ0BROIt65BlWWyOK62c8pmhM=">AAACH3icbVC7TsMwFHXKq5RXgJHFouIxVUlVAWOlLowF0YfUhMpxndaq7US2g1RF+QN+gl9ghZ0NsXblS3DaDtByJEvnnnuvzvUJYkaVdpypVVhb39jcKm6Xdnb39g/sw6O2ihKJSQtHLJLdACnCqCAtTTUj3VgSxANGOsG4kfc7T0QqGokHPYmJz9FQ0JBipI3Ut889jvQoCNNOBj0q4LwM0vvsMW1ceJpyomAj69tlp+LMAFeJuyBlsECzb397gwgnnAiNGVKq5zqx9lMkNcWMZCUvUSRGeIyGpGeoQMbHT2f/yeCZUQYwjKR5QsOZ+nsjRVypCQ/MZH6uWu7l4r+9gC856/DGT6mIE00EnhuHCYM6gnlYcEAlwZpNDEFYUnM7xCMkEdYm0pIJxV2OYJW0qxX3qlK7q5Xr1UU8RXACTsElcME1qINb0AQtgMEzeAVv4N16sT6sT+trPlqwFjvH4A+s6Q/KyaML</latexit>W2RC0⇥C<latexit sha1_base64="Cixo755/tUngOI9zaGdXRfjqmBI=">AAACIHicbVDLTgIxFO34RHyhLt00EoMrMqNEWZKwcYlGHgkzkrYUaGg7k7ZjQibzCf6Ev+BW9+6MS136JRaYhYInaXJyzr05twdHnGnjup/Oyura+sZmbiu/vbO7t184OGzpMFaENknIQ9XBSFPOJG0aZjjtRIoigTlt43F96rcfqNIslHdmEtFAoKFkA0aQsVKvUPKxSFrpfTJKoc8k9AUyI4yTWyvVS9A3TFANL9JeoeiW3RngMvEyUgQZGr3Ct98PSSyoNIQjrbueG5kgQcowwmma92NNI0TGaEi7lkpkc4Jk9qEUnlqlDwehsk8aOFN/byRIaD0R2E5O79WL3lT818NiIdkMqkHCZBQbKsk8eBBzaEI4bQv2maLE8IkliChmb4dkhBQixnaat6V4ixUsk9Z52bssV24qxVo1qycHjsEJOAMeuAI1cA0aoAkIeATP4AW8Ok/Om/PufMxHV5xs5wj8gfP1A0Nlo0U=</latexit>Vh2RC0⇥3<latexit sha1_base64="wPRpnMNngHObBZ/mRfLvRDSWios=">AAACSXicdVBNaxNBGJ5Nq9bUatSjl8FQ2l6W3W2yDUKh4KXHCCYpdMMyO5lNhs7sLDPvqmHYv+Wf8BcUPBXqvbfSk5OPohb7wgsPz/N+PlkpuIEguPQaG5tPnj7bet7cfrHz8lXr9ZuhUZWmbECVUPosI4YJXrABcBDsrNSMyEywUXbxcaGPvjBtuCo+w7xkY0mmBc85JeCotNVPMmmHdWoTYN/AUm3qeg9/OMY4kQRmWW5H9X6i3AjNpzMgWquv9o+URjVOgEtm8GrQQdpqB34URL34EAd+txvFYc+Bo24njkMc+sEy2mgd/bR1lUwUrSQrgApizHkYlDC2RAOngtXNpDKsJPSCTNm5gwVxy8Z2+XmNdx0zwbnSLgvAS/bvDkukMXOZucrFzeahtiD/q2XywWbIe2PLi7ICVtDV4rwSGBRe2IonXDMKYu4AoZq72zGdEU0oOPObzpT7z/HjYBj5Yex3PnXaJ9Hani30Dr1H+yhER+gEnaI+GiCKvqOf6Br98n54N96td7cqbXjrnrfon2hs/AZS3bST</latexit>V0crs:=W(  !W2⇥V)<latexit sha1_base64="hY83B3SOKijJh0XYK+Vp424IrjA=">AAACIXicdVDLSgMxFM34rPVVdekmWERXw0ztC0EouHFZwT7AKSWTZjSYzAzJHbEM8wv+hL/gVvfuxJ2480tMH4IWPRA4nHNv7r3HjwXX4Djv1tz8wuLScm4lv7q2vrFZ2Npu6yhRlLVoJCLV9YlmgoesBRwE68aKEekL1vFvTkd+55YpzaPwAoYx60lyFfKAUwJG6hcOPV+m7ayfesDuIDXfZNkBPj7BniRw7QdpJ5tWFIqOXXKO3FIFO3alUnPLdUNqlXK1WsWu7YxRRFM0+4VPbxDRRLIQqCBaX7pODL2UKOBUsCzvJZrFhN6QK3ZpaEgk0710fFGG940ywEGkzAsBj9WfHSmRWg+lbypHe+pZbyT+6flyZjIE9V7KwzgBFtLJ4CARGCI8igsPuGIUxNAQQhU3u2N6TRShYELNm1C+L8f/k3bJdqt2+bxcbJSm8eTQLtpDh8hFNdRAZ6iJWoiie/SIntCz9WC9WK/W26R0zpr27KBfsD6+ANOwpMc=</latexit>V0lin:=WV<latexit sha1_base64="lSB+HKs32Deuf6OBdmPI5tCSypY=">AAACIXicdVDLSgMxFM34tr6qLt0Ei+hqyJQ+VBAENy4V7AOcUjJppg0mM0NyRyzD/II/4S+41b07cSfu/BLTWkFFDwQO59ybe+8JEikMEPLqTE3PzM7NLywWlpZXVteK6xtNE6ea8QaLZazbATVciog3QIDk7URzqgLJW8HVychvXXNtRBxdwDDhHUX7kQgFo2ClbnHPD1Rm8m7mA7+BzH6T57v48Aj7isIgCLNWPqkolohbJgdebR8Tt1qtk4OyJfVqpVYn2HPJGCU0wVm3+O73YpYqHgGT1JhLjyTQyagGwSTPC35qeELZFe3zS0sjqrjpZOOLcrxjlR4OY21fBHisfu/IqDJmqAJbOdrT/PZG4p9eoH5NhnC/k4koSYFH7HNwmEoMMR7FhXtCcwZyaAllWtjdMRtQTRnYUAs2lK/L8f+kWXa9mls5r5SOy5N4FtAW2kZ7yEN1dIxO0RlqIIZu0T16QI/OnfPkPDsvn6VTzqRnE/2A8/YBPRelBw==</latexit>s0lin:=Ws<latexit sha1_base64="Lgbfa33XOO/uoFthIg6IurbRR3w=">AAACO3icdVBNb9NAEF0XKCHQEuDIZUWE2pNlO18tElJELxyLRJJKdWStN+tk1V2vtTsGopX/D3+Cv8AVuLa3imvvXaep1Fbtk0Z6ejNPM/PSQnADQfDP23j0+Mnm08az5vMXW9svW69ej40qNWUjqoTSRykxTPCcjYCDYEeFZkSmgk3Sk4O6P/nGtOEq/wrLgk0lmec845SAk5LWpziV1lSJjYH9ADtTUFU7+MNHHCtn03y+AKK1+m5jSWCRZnZSJWGFY+omce0dV0mrHfiD/d5gr4sDvxdEnUHkSD+I9vsdHPrBCm20xmHSOo1nipaS5UAFMeY4DAqYWqKBU8GqZlwaVhB6Qubs2NGcSGamdvVrhd87ZYYzpV3lgFfqTYcl0pilTN1kfbG526vFe3upvLMZsr2p5XlRAsvp1eKsFBgUroPEM64ZBbF0hFDN3e2YLogmFFzcTRfK9ef4YTKO/LDvd79028NoHU8DvUXv0C4K0QAN0Wd0iEaIop/oN/qD/nq/vDPv3Pt/NbrhrT1v0C14F5caVrAj</latexit>s0dot:=  !W1·V<latexit sha1_base64="W+iAC8/GL6nDnEBUEg846PUDTOg=">AAACM3icdVBNSyNBEO3RVWP8inrcS7NBdk/DZIyJBhYEL3t0YZMITgg9nZ6kSff00F2za2jmv/gn/At71at4E6/7H7YnZmEVfVDweK+KqnpxJriBILj3lpY/rKyuVdarG5tb2zu13b2eUbmmrEuVUPoiJoYJnrIucBDsItOMyFiwfjw9K/3+T6YNV+kPmGVsIMk45QmnBJw0rHWiWNpeMbQRsCuwgidQFJ9x5ysuDVNEyk1rPp4A0Vr9spEkMIkT2y+KYa0e+O2To/ZxEwf+URAetkNHWkF40jrEDT+Yo44WOB/WHqORorlkKVBBjLlsBBkMLNHAqWBFNcoNywidkjG7dDQlkpmBnf9Y4AOnjHCitKsU8Fz9f8ISacxMxq6zPNG89krxTS+WrzZDcjywPM1yYCl9XpzkAoPCZYB4xDWjIGaOEKq5ux3TCdGEgou56kL59zl+n/RCv9Hym9+b9dNwEU8FfUSf0BfUQG10ir6hc9RFFF2j3+gW3Xk33oP36D09ty55i5l99ALen79Vl61l</latexit>V0lift:=s !W<latexit sha1_base64="AEu2t5IYdD9jSuBF7SjRLU7tjDQ=">AAACAXicbVC7SgNBFL0bXzG+opY2g0GwCrsSNGXAxjKCeWCyhtnJbDJkZnaZmRXCspW/YKu9ndj6JbZ+iZNkC008cOFwzr2cywlizrRx3S+nsLa+sblV3C7t7O7tH5QPj9o6ShShLRLxSHUDrClnkrYMM5x2Y0WxCDjtBJPrmd95pEqzSN6ZaUx9gUeShYxgY6X7fiDSdvaQjrNBueJW3TnQKvFyUoEczUH5uz+MSCKoNIRjrXueGxs/xcowwmlW6ieaxphM8Ij2LJVYUO2n848zdGaVIQojZUcaNFd/X6RYaD0Vgd0U2Iz1sjcT//UCsZRswrqfMhknhkqyCA4TjkyEZnWgIVOUGD61BBPF7O+IjLHCxNjSSrYUb7mCVdK+qHqX1dptrdKo5/UU4QRO4Rw8uIIG3EATWkBAwjO8wKvz5Lw5787HYrXg5DfH8AfO5w9nUJe6</latexit>Vh<latexit sha1_base64="AEu2t5IYdD9jSuBF7SjRLU7tjDQ=">AAACAXicbVC7SgNBFL0bXzG+opY2g0GwCrsSNGXAxjKCeWCyhtnJbDJkZnaZmRXCspW/YKu9ndj6JbZ+iZNkC008cOFwzr2cywlizrRx3S+nsLa+sblV3C7t7O7tH5QPj9o6ShShLRLxSHUDrClnkrYMM5x2Y0WxCDjtBJPrmd95pEqzSN6ZaUx9gUeShYxgY6X7fiDSdvaQjrNBueJW3TnQKvFyUoEczUH5uz+MSCKoNIRjrXueGxs/xcowwmlW6ieaxphM8Ij2LJVYUO2n848zdGaVIQojZUcaNFd/X6RYaD0Vgd0U2Iz1sjcT//UCsZRswrqfMhknhkqyCA4TjkyEZnWgIVOUGD61BBPF7O+IjLHCxNjSSrYUb7mCVdK+qHqX1dptrdKo5/UU4QRO4Rw8uIIG3EATWkBAwjO8wKvz5Lw5787HYrXg5DfH8AfO5w9nUJe6</latexit>Vh<latexit sha1_base64="FD5R+EX37O0wwgqUBXiE4ChEQv8=">AAACF3icbVDLSgMxFM3UV62vqktBgkV0VWakaJeFblxWsQ/ojCVJM21okhmSjFCG2fkT/oJb3bsTty7d+iWmj4W2HrhwOOde7r0Hx5xp47pfTm5ldW19I79Z2Nre2d0r7h+0dJQoQpsk4pHqYKQpZ5I2DTOcdmJFkcCctvGoPvHbD1RpFsk7M45pINBAspARZKzUKx77WKQ6u0+HGfSZhL5AZohxemul+lnWK5bcsjsFXCbenJTAHI1e8dvvRyQRVBrCkdZdz41NkCJlGOE0K/iJpjEiIzSgXUslElQH6fSPDJ5apQ/DSNmSBk7V3xMpElqPBbadkzP1ojcR//WwWNhswmqQMhknhkoyWxwmHJoITkKCfaYoMXxsCSKK2dshGSKFiLFRFmwo3mIEy6R1UfYuy5WbSqlWnceTB0fgBJwDD1yBGrgGDdAEBDyCZ/ACXp0n5815dz5mrTlnPnMI/sD5/AENJ6AX</latexit>sh2RC0<latexit sha1_base64="AIcTtTyhTj/XRhgKmZpjtRh7Np4=">AAACQXicbVDLSgMxFM3Ud31VXboJFlEQyoyIuhEENy4V7AM6tWTSTCc0mQzJHaUM80v+hL/gxoUu3LkTt27MtF1o9UDg3HPv4d6cIBHcgOs+O6WZ2bn5hcWl8vLK6tp6ZWOzYVSqKatTJZRuBcQwwWNWBw6CtRLNiAwEawaDi6LfvGPacBXfwDBhHUn6MQ85JWClbuXSD2Rm8j18hsfsNsIH2FfWo3k/AqK1us98SSAKwqyZ592smGvkOfZpTwEeV7dRt1J1a+4I+C/xJqSKJrjqVt78nqKpZDFQQYxpe24CnYxo4FSwvOynhiWEDkiftS2NiWSmk41+nONdq/RwqLR9MeCR+tOREWnMUAZ2sjjdTPcK8d9eIKc2Q3jayXicpMBiOl4cpgKDwkWcuMc1oyCGlhCqub0d04hoQsGGXraheNMR/CWNw5p3XDu6PqqeH07iWUTbaAftIw+doHN0ia5QHVH0gJ7QC3p1Hp1358P5HI+WnIlnC/2C8/UN1xOx5g==</latexit>s0=sh+ !WV·Vh<latexit sha1_base64="PXameL+BfNGvHPXa8ZKpst57nWI=">AAACQXicbVC7TsMwFHV4U14FRhaLClGWKkEIWJCQWBhBog+pKZXjOo1VO47sG1AV5Zf4CX6BhQEGNjbEyoLTdoDClSwdnYfu9QkSwQ247rMzMzs3v7C4tFxaWV1b3yhvbjWMSjVldaqE0q2AGCZ4zOrAQbBWohmRgWDNYHBR6M07pg1X8Q0ME9aRpB/zkFMCluqWL/1AZo18H5/hagFNfhthX9mI5v0IiNbqPvMlgSgIs2aed7OxKz+wrp4CPM7fRt1yxa25o8F/gTcBFTSZq275ze8pmkoWAxXEmLbnJtDJiAZOBctLfmpYQuiA9FnbwphIZjrZ6Mc53rNMD4dK2xcDHrE/ExmRxgxlYJ3F7WZaK8h/tUBObYbwtJPxOEmBxXS8OEwFBoWLOnGPa0ZBDC0gVHN7O6YR0YSCLb1kS/GmK/gLGoc177h2dH1UOT+c1LOEdtAuqiIPnaBzdImuUB1R9ICe0At6dR6dd+fD+RxbZ5xJZhv9GufrG/cbsfg=</latexit>V0=(sh !Ws) Vh<latexit sha1_base64="UeHEfi8IZX6NBZSVBXKUZMKtiEI=">AAACHXicbVDLTgIxFO34RHyhLt00otEVmVGiLEnYuEQjj4QZSVsKNLSdSdsxIZP5AX/CX3Cre3fGrXHrl9gBFgqepMnJOffm3B4ccaaN6345S8srq2vruY385tb2zm5hb7+pw1gR2iAhD1UbI005k7RhmOG0HSmKBOa0hUe1zG89UKVZKO/MOKKBQAPJ+owgY6Vu4djHImmmp9BnEvoCmSHGyW16n9SsZJigGl6k3ULRLbkTwEXizUgRzFDvFr79XkhiQaUhHGnd8dzIBAlShhFO07wfaxohMkID2rFUIpsTJJPfpPDEKj3YD5V90sCJ+nsjQULrscB2MrtXz3uZ+K+HxVyy6VeChMkoNlSSaXA/5tCEMKsK9piixPCxJYgoZm+HZIgUIsYWmrelePMVLJLmecm7LJVvysVqZVZPDhyCI3AGPHAFquAa1EEDEPAInsELeHWenDfn3fmYji45s50D8AfO5w8Y3aGQ</latexit>V02RC0⇥3<latexit sha1_base64="hNjbOsNKJbZMsS+go8BAJ6ASVXU=">AAACFHicbVC7TgJBFJ31ifhCLWkmEoMV2TVEKUloLNHII2FXMjMMMGFmdjMza0I2W/gT/oKt9nbG1t7WL3GALRQ8yU1Ozrk3996DI860cd0vZ219Y3NrO7eT393bPzgsHB23dRgrQlsk5KHqYqQpZ5K2DDOcdiNFkcCcdvCkMfM7D1RpFso7M41oINBIsiEjyFipXyj6WCQ6LUOfSegLZMYYJ7fpfdIop/1Cya24c8BV4mWkBDI0+4VvfxCSWFBpCEda9zw3MkGClGGE0zTvx5pGiEzQiPYslUhQHSTzJ1J4ZpUBHIbKljRwrv6eSJDQeiqw7ZydqZe9mfivh8XSZjOsBQmTUWyoJIvFw5hDE8JZQnDAFCWGTy1BRDF7OyRjpBAxNse8DcVbjmCVtC8q3mWlelMt1WtZPDlQBKfgHHjgCtTBNWiCFiDgETyDF/DqPDlvzrvzsWhdc7KZE/AHzucP8L6eYg==</latexit>s02RC0<latexit sha1_base64="AEu2t5IYdD9jSuBF7SjRLU7tjDQ=">AAACAXicbVC7SgNBFL0bXzG+opY2g0GwCrsSNGXAxjKCeWCyhtnJbDJkZnaZmRXCspW/YKu9ndj6JbZ+iZNkC008cOFwzr2cywlizrRx3S+nsLa+sblV3C7t7O7tH5QPj9o6ShShLRLxSHUDrClnkrYMM5x2Y0WxCDjtBJPrmd95pEqzSN6ZaUx9gUeShYxgY6X7fiDSdvaQjrNBueJW3TnQKvFyUoEczUH5uz+MSCKoNIRjrXueGxs/xcowwmlW6ieaxphM8Ij2LJVYUO2n848zdGaVIQojZUcaNFd/X6RYaD0Vgd0U2Iz1sjcT//UCsZRswrqfMhknhkqyCA4TjkyEZnWgIVOUGD61BBPF7O+IjLHCxNjSSrYUb7mCVdK+qHqX1dptrdKo5/UU4QRO4Rw8uIIG3EATWkBAwjO8wKvz5Lw5787HYrXg5DfH8AfO5w9nUJe6</latexit>Vh<latexit sha1_base64="CUoFZReipeYa/YPpeQWBtjIfzWg=">AAACAXicbVC7SgNBFL0bXzG+opY2g0GwCrsSNGXAxjKCeWCyhtnJbDJkZnaZmRXCspW/YKu9ndj6JbZ+iZNkC008cOFwzr2cywlizrRx3S+nsLa+sblV3C7t7O7tH5QPj9o6ShShLRLxSHUDrClnkrYMM5x2Y0WxCDjtBJPrmd95pEqzSN6ZaUx9gUeShYxgY6X7fiBSnT2k42xQrrhVdw60SrycVCBHc1D+7g8jkggqDeFY657nxsZPsTKMcJqV+ommMSYTPKI9SyUWVPvp/OMMnVlliMJI2ZEGzdXfFykWWk9FYDcFNmO97M3Ef71ALCWbsO6nTMaJoZIsgsOEIxOhWR1oyBQlhk8twUQx+zsiY6wwMba0ki3FW65glbQvqt5ltXZbqzTqeT1FOIFTOAcPrqABN9CEFhCQ8Awv8Oo8OW/Ou/OxWC04+c0x/IHz+QOVpZfX</latexit>sh<latexit sha1_base64="CUoFZReipeYa/YPpeQWBtjIfzWg=">AAACAXicbVC7SgNBFL0bXzG+opY2g0GwCrsSNGXAxjKCeWCyhtnJbDJkZnaZmRXCspW/YKu9ndj6JbZ+iZNkC008cOFwzr2cywlizrRx3S+nsLa+sblV3C7t7O7tH5QPj9o6ShShLRLxSHUDrClnkrYMM5x2Y0WxCDjtBJPrmd95pEqzSN6ZaUx9gUeShYxgY6X7fiBSnT2k42xQrrhVdw60SrycVCBHc1D+7g8jkggqDeFY657nxsZPsTKMcJqV+ommMSYTPKI9SyUWVPvp/OMMnVlliMJI2ZEGzdXfFykWWk9FYDcFNmO97M3Ef71ALCWbsO6nTMaJoZIsgsOEIxOhWR1oyBQlhk8twUQx+zsiY6wwMba0ki3FW65glbQvqt5ltXZbqzTqeT1FOIFTOAcPrqABN9CEFhCQ8Awv8Oo8OW/Ou/OxWC04+c0x/IHz+QOVpZfX</latexit>sh<latexit sha1_base64="CUoFZReipeYa/YPpeQWBtjIfzWg=">AAACAXicbVC7SgNBFL0bXzG+opY2g0GwCrsSNGXAxjKCeWCyhtnJbDJkZnaZmRXCspW/YKu9ndj6JbZ+iZNkC008cOFwzr2cywlizrRx3S+nsLa+sblV3C7t7O7tH5QPj9o6ShShLRLxSHUDrClnkrYMM5x2Y0WxCDjtBJPrmd95pEqzSN6ZaUx9gUeShYxgY6X7fiBSnT2k42xQrrhVdw60SrycVCBHc1D+7g8jkggqDeFY657nxsZPsTKMcJqV+ommMSYTPKI9SyUWVPvp/OMMnVlliMJI2ZEGzdXfFykWWk9FYDcFNmO97M3Ef71ALCWbsO6nTMaJoZIsgsOEIxOhWR1oyBQlhk8twUQx+zsiY6wwMba0ki3FW65glbQvqt5ltXZbqzTqeT1FOIFTOAcPrqABN9CEFhCQ8Awv8Oo8OW/Ou/OxWC04+c0x/IHz+QOVpZfX</latexit>sh<latexit sha1_base64="W5Bi3CDnuC6C2aA15WS6lmf3xfo=">AAACMHicdVBNSwMxEM36WetX1aOXYBE8lW1t1aPQi8cq9gO6tWTTbBvMJksyq5Rlf4p/wr/gVe96Ej36K8y2FVR0IOTNezPMzPMjwQ247oszN7+wuLScW8mvrq1vbBa2tltGxZqyJlVC6Y5PDBNcsiZwEKwTaUZCX7C2f13P9PYN04YreQnjiPVCMpQ84JSApfqFY09ZWfPhCIjW6jbxQgIjP0jaaYo9LvE095OL9CqpYw94yAw+TPuFoluquTYq2C1lf7WGZ0wNlyeM6xbRLBr9wrs3UDQOmQQqiDHdshtBLyEaOBUszXuxYRGh12TIuhZKYuf0ksmBKd63zAAHStsnAU/Y7x0JCY0Zh76tzNY1v7WM/FPzw1+TITjpJVxGMTBJp4ODWGBQOHMPD7hmFMTYAkI1t7tjOiKaULAe560pX5fj/0GrUioflarn1eJpZWZPDu2iPXSAyugYnaIz1EBNRNEdekCP6Mm5d56dV+dtWjrnzHp20I9wPj4BMpKrEQ==</latexit> !W2RC⇥3<latexit sha1_base64="67DBAT3iRCAP07g/holzhbfkphA=">AAACOnicdVDLThsxFPXQ8gqvtCzZWI0QrKJJSIAlFZsuoSIEiQmR7XgSK36M7DugyJrv6U/0F9hSsWVXdcsH1JMEqUVwJctH59yrc++hmRQO4vgxWvjwcXFpeWW1sra+sblV/fT50pncMt5hRhp7RYnjUmjeAQGSX2WWE0Ul79Lxaal3b7l1wugLmGS8p8hQi1QwAoHqV78mJshWDEdArDV3PlEERjT13aLvE6q8K4oCJ0LjmUD99+LGn+7hBITiDh8U/WotrrfjUE0c18u/1cZzpo0bUyaOa2heZ/3qUzIwLFdcA5PEuetGnEHPEwuCSV5UktzxjLAxGfLrADUJPj0/PbXAu4EZ4NTY8DTgKfvvhCfKuYmiobPc173WSvJNjapXzpAe97zQWQ5cs5lxmksMBpc54oGwnIGcBECYFWF3zEbEEgYh7UoI5eVy/D64bNYbh/XWeat20pzHs4J20Be0jxroCJ2gb+gMdRBDP9A9ekC/op/RU/Q7+jNrXYjmM9vov4qe/wIVDq+J</latexit>  !Ws2RC0⇥3<latexit sha1_base64="sY7ejSHsmibeFFxxfgJU5T8YFtQ=">AAACQ3icdVDLahsxFNW4jyROH0677EbUBGdlxo7dZGnwpnSVltoOZBwjyRpbWI9BupNgxPxTf6K/UOiqIdvuSraFauwptKG9IHQ4517OvYdmUjiI469R7cHDR493dvfq+0+ePnveOHgxdia3jI+YkcaeU+K4FJqPQIDk55nlRFHJJ3Q1LPXJFbdOGP0R1hmfKrLQIhWMQKBmjXeJCbIViyUQa821TxSBJU39pJj5hCo/LooCJ0LjrUD9h+LSD1sJCMUdHrZwhY6LWaMZt/txqC6O2+Xf6+OK6ePOhonjJqrqbNa4TeaG5YprYJI4d9GJM5h6YkEwyYt6kjueEbYiC34RoCbBZ+o3Nxf4MDBznBobnga8Yf+c8EQ5t1Y0dJaLu/taSf5To+qeM6SnUy90lgPXbGuc5hKDwWWgeC4sZyDXARBmRdgdsyWxhEGIvR5C+X05/j8Yd9udN+3e+15z0K3i2UWv0Gt0hDroBA3QW3SGRoihT+gL+oZuos/R9+hHdLdtrUXVzEv0V0U/fwHyCrLO</latexit>  !WV2RC0⇥C0⇥3̸
Under review as a conference paper at ICLR 2023

scalar-lists to vector-lists V
2021; Jing et al., 2020):

RC

∈

3 with a linear operation mapping to V ′

×

RC′

3 (Deng et al.,

×

∈

(2)
V ′ = WV
Under this construction, SO(3)-actions in the latent space are simply matrix multiplications, which
establishes a clear 3D Euclidean structure. However, to maintain input-output consistency under
rigid transformations (e.g. rotation and translation), their operations are still limited to classical lin-
ear combinations weighted by W. To define operations that are more adaptive to the geometrically
meaningful features, we introduce the Directed Weights, that we can define any tensor with the last
dimension of 3 as a directed weight matrix, for example, ⃗W
3, seen as a stack of geo-
metric meaningful vectors lying in the 3D Euclidean Space, and can be acted by SE(3) group from
the right.

RC′

∈

×

×

C

3.2

⃗W-OPERATORS

With weights and features both equipped with 3D vector representations, we can design a set of
) with learnable ⃗W as parameters in neural networks, which can
geometric operators □ (e.g.
operate on both scalar-list features s

or

×

3

·

∈

RC and vector-list features V
⃗W□V

⃗W□s,

RC

×

∈

(3)

C be a conventional scalar weight matrix, ⃗W1 ∈
3 be directed weight tensors. Beyond linear combinations, We can define

RC′

∈

×

C

×

×

RC

3 and ⃗W2 ∈

Geometric vector operations. Let W
RC′
×
two operations that leverage geometric information:
s′dot(V ; ⃗W1) = ⃗W1 ·
V ′crs(V ; W, ⃗W2) = W( ⃗W2 ×

V

C′

R

(4)

∈

C′

3

j,k

R

V )

⃗W i,j,k

(5)
Here s′dot transforms C vector features to C ′ scalars using dot-product with directed weights, de-
tailedly, s′i = (cid:80)
1 V j,k, which explicitly measures angles between vectors, and this opera-
tor brings network the ability to accurately sense the orientational features. In V ′crs, a vector crosses a
directed weight before being projected onto the hidden space. While the output of plain linear com-
binations between two vectors v1 and v2 can only lie in the plane w1v1 + w2v2, cross-product in
Equation 5 creates a new direction outside the plane, which is crucial in 3D modelling. For instance,
the side-chain angles of a given residue could be largely determined by its Cα and Cβ vectors, but
may lie on the direction perpendicular to the space constructed by the two vectors.

∈

×

Scalar lifting. In addition, a directed weight ⃗W
∈
following operation, the ij th entry of s ⃗W is si ⃗Wij

RC

×

3 can lift scalars to vectors by adopting the

V ′lift(s; ⃗W) = s ⃗W

C

3

×

R

(6)

This maps each scalar to a particular vector, enabling inverse transformations or information bottle-
necks from R to R3. An intuition example is that, we can map a scalar representing the distance
between two amino acids to a vector pointing from one amino acid to the other, leading to more
biological meaningful representations for the protein fragment.

Linear combinations. In the end, we keep the linear combination operations with scalar weights
for both scalar and vector features:

s′lin(s; W) = Ws
V ′lin(V ; W) = WV

C′

C′

3

×

R

R

(7)

(8)

While these operators enables a more flexible network design, equivariance to rigid transformations
is broken if considering more complex functions beyond linear combinations. We will introduce a
globally equivariant paradigm to tackle this issue in Section 4.

∈

∈

∈

3.3

⃗W-PERCEPTRON UNIT

Now we combine all the ⃗W-operators together, assembling them into what we call Directed Weight
Perceptrons ( ⃗W-perceptrons). A ⃗W-perceptron unit is a function mapping from u = (s, V ) to

4

Under review as a conference paper at ICLR 2023

another scalar-vector tuple u′ = (s′, V ′), which can be stacked as network layers to form multi-
layer perceptrons.

A single unit comprises three modules in a sequential way: the Directed Linear module, the Non-
Linearity module, and the Directed Interaction module (Figure 2).

Directed linear module. The output hidden representations derived from the set of operations in-
troduced previously are concatenated and projected into another hidden space of scalars and vectors
separately:

sh = Ws[s′dot, s′lin]
V h = WV [V ′crs, V ′lift, V ′lin]

C′

C′

3

×

R

R

∈

∈

(9)

(10)

×

RC′

(C′+C′) and WV ∈

(C′+C+C′) are scalar weight matrices. In other word,
Here Ws ∈
the five separate updating functions allow transformation from scalar to scalar (Equation 7), scalar
to vector (Equation 6), vector to scalar (Equation 4), and vector to vector (Equation 8, Equation 5),
boosting the model’s capability to reason in 3D space.

RC′

×

Non-linearity module. We then apply the non-linearity module to the hidden representation
(sh, V h). Specifically, we apply standard ReLU non-linearity (Nair & Hinton, 2010) to the scalar
components. For the vector representations, following (Weiler et al., 2018; Jing et al., 2020; Sch¨utt
et al., 2021), we compute a sigmoid activation on the L2-norm of each vector and multiply it back
to the vector entries accordingly:

sh

vh
ij ←
R3 are the vector columns in V h and vh

ReLU(sh),

←

ij are their entries.

vh
ij ·

sigmoid(

vh
i ∥2)
∥

(11)

where vh

i ∈

Directed interaction module. Finally we introduce the Directed Interaction module, integrating the
hidden features sh and V h into the output tuple (s′, V ′)

s′ = sh + ⃗WV ·
V ′ = (sh ⃗Ws)
⊙

V h
V h

∈

C′

3

×

R

C′

R

(12)

(13)

∈
Here ⃗WV , ⃗Ws are directed weight matrices with sizes C ′
de-
notes element-wise multiplication for two matrices. This module establishes a connection between
the scalar and vector feature components, facilitating feature blending. Specifically, Equation 12
dynamically determines how much the output should rely on scalar and vector representations, and
Equation 13 weights a list of vectors using the scalar features as attention scores.

3, respectively,

3 and C ′

C ′

×

⊙

×

×

4 ORIENTATION-AWARE GRAPH NEURAL NETWORKS

To achieve SO(3)-equivariance without the loss of modeling capacity, we introduce an equivariant
message passing paradigm on protein graphs, to easily plug our versatile ⃗W-Perceptron into any
existing graph learning framework, which makes network architectures free from equivariant con-
straints (Section 4.1). The integrated models, called Orientation-Aware Graph Neural Networks,
can not only accurately model the essential orientational features but also maintain the rotation
equivariance efficiently. We also design multiple variants in analogy to other graph neural networks
Section 4.2.

4.1 EQUIVARIANT MESSAGE PASSING ON PROTEINS

A function f : R3
R3

×

→

3 applied to the input vector x leads to the same transformation on the output f (x):

R3 is SO(3)-equivariant (rotation-equivariant) if any rotation matrix R

∈

Such equivariant property can be achieved on a protein graph with local orientations, which is nat-
urally defined from its biological structure (Ingraham et al., 2019). Specifically, each amino acid

Rf (x) = f (Rx)

(14)

5

Under review as a conference paper at ICLR 2023

node ui ∈ V

has four backbone heavy atom (C u

α, C u, N u, Ou), defining a local frame Ou as:
3

xu = N u

C u

α ∈

3, yu = C u

R

(15)

,

Ou =

xu
xu∥2 ×
∥
The local frame Ou is a rotation matrix that maps a 3D vector from the local to the global coor-
dinate system. An equivariant message passing paradigm then emerges through transforming node
features back and forth between adjacent local frames. Formally, give an amino acid u with hidden
representation h = (s, V ), let fl and fg be transformations on the vector feature V from and to the
global coordinate system:

yu
yu∥2
∥

(16)

R

∈

×

3

3

,

R

C u

α ∈
(cid:21)⊤

−
yu
yu∥2
∥

−
(cid:20) xu
xu∥2
∥

fl(h, Ou) := (s, V O⊤u ),

fg(h, Ou) := (s, V Ou)

(17)

The message passing update for node u from layer l to layer l + 1 is performed in the following
steps, the [
] notations indicates the concatenation of different hidden representations along the
channel-wise dimension:

1. Transform the neighbourhood vector representations of u into its local coordinate system

Ou.

2. For each adjacent node v, compute the message ml+1

u

layer ⃗W-perceptron
F
3. Update node feature hl

to the aggregated node and edge feature [hl
u with another multi-layer ⃗W-perceptron

on edge (u, v)
u, hl

with an multi-
∈ E
v, el
uv] (Equation 18).
, and transform it back

to the global coordinate system (Equation 19).

H

This paradigm achieves SO(3)-equivariance in a very general sense with no constraints on
The formal proof of equivariance is presented in the Appendix Section A.

,

.

H

F

ml+1

u =

(fl([hl

u, hl

v, el

uv], Ou))

(cid:88)

F

u

v

∈N
hl+1
u = fg(

H

(hl

u, ml+1

u ), Ou)

(18)

(19)

4.2 VARIANTS OF ORIENTATION-AWARE GRAPH NEURAL NETWORKS

By integrating the ⃗W-Perceptrons with equivariant message passing, we propose multiple variants
of entire Orientation-Aware Graph Neural Networks to boost the design space for different tasks.

OA-GCN. This is the one described and implemented in the previous subsection with Equation 18
and Equation 19.

OA-GIN. We adopt graph isomorphism operator Xu et al. (2018) with learnable weighing parameter
ε for tunable skip connections,

ml+1

u = (1 + ε)fl(hl

u, Ou) +

(fl(hl

v, Ou))

(cid:88)

F

v

u

∈N

(20)

OA-GAT. In comparison to GCN and GIN, it is not trivial to incorporate with the Graph Attention
Network (GAT) (Veliˇckovi´c et al., 2018), as residues interact with each other unevenly in proteins.
In particular, we define separate attentions for the scalar and vector representations

(sl

u, V l

u) = fl(hl
u, Ou)
(cid:88)
s′u =

vsl
αs

v, V ′u =

v

u

u

∈N
hl+1
u = fg(

}

∪{
((s′, V ′)), Ou)

(cid:88)

vV l
αv
v

v

u

∈N

u

}

∪{

(21)

(22)

(23)
The attention scores αs, αv are the softmax values over the inner products of all neighboring source-
target pairs defined as the follows:

H

αs

v =

(cid:80)

w

su, sv⟩
exp (
⟨
exp (
⟨

)
)
su, sw⟩

∪{

u

}

u

∈N

, αv

v =

(cid:80)

w

exp (tr(V ⊤u Vv))

u

∈N

∪{

}

u

exp (tr(V ⊤u Vv))

(24)

The product for scalars and vectors are standard inner product and Frobenius product, respectively.

6

Under review as a conference paper at ICLR 2023

5 EXPERIMENTS

To demonstrate the basic rationale in perceiving angular features of our ⃗W-Perceptron, we design
a synthetic task (Section 5.1). We then conduct experiments on multiple benchmarks, including
node-level tasks: Residue Identification (RES) (Section 5.2), Computational Protein Design (CPD)
(Section 5.3), and graph-level tasks: Model Quality Assessment (MQA) (Section 5.4). Ablation
studies are also included (Section 5.5). More details are documented in the Appendix Section B.

5.1 SYNTHETIC TASK

Figure 3: a). The synthetic study. The vector in red is the anchor used to calculate the ground truth
labels. Vectors falling into the cone are positive samples, whereas outside points are negative. b).
The validation Binary Cross Entropy loss of compared methods.

Datasets. We test the performance of different perceptron designs on a synthetic binary classifica-
R3 as the anchor vector. Then
tion dataset with angular. We sample a random unit vector vm ∈
π/4,
each vector vi in the space is labeled positive if its angle between the anchor vector ami ≤
and negative otherwise. We generate 100, 000 random vectors with 50% positive samples and 50%
negative samples. For a fair comparison, we restrict the number of parameters and hyperparameters
of different models to approximately the same.

Results. As shown in Figure 3, in general, our ⃗W-Perceptron (DWP) converges faster than other
models and achieves the lowest validation loss. We also notice that the Geometric Vector Perceptron
(GVP) cannot converge given a sufficient number of epochs due to the poor capability of perceiving
angulars by only using linear combinations of vector features. In comparison to GVP, Vector Neural
Network (VNN) performs better based on its non-linear ReLU operation for vector features. Sim-
ple Multi-Layer Perceptron (MLP) can also capture useful information according to its universal
approximation ability. The superior performance demonstrates that our ⃗W-Perceptron has a better
ability on perceiving potential geometric features in space.

5.2 RESIDUE IDENTIFICATION

Datasets. Residue Identification (RES) aims to predict the identity of particular masked amino acid
based on its local surrounding structure (Torng & Altman, 2017). We download 1000, 000 (106)
substructures from the ATOM3D project (Townshend et al., 2021), which are originally derived from
574 proteins from the PDB (Berman et al., 2000). The entire dataset is split into training, validation,
and testing datasets with the ratio of 80%, 10%, and 10%. There are no two proteins with similar
structures in the test and non-test datasets based on the CATH 4.2 topology class at the domain level
(Orengo et al., 1997).

Metrics. We use classification accuracy to evaluate model performance.

Baselines. The 3D-CNN encodes the positions of the atoms in a voxelized 3D volume. We also
compare GNN variants such as GCN , GIN and GAT with our OA-GCN, OA-GIN and OA-GAT
models. We also include GVP-GNN as well.

Results As shown in Table 1, GCN, GIN and GAT almost cannot accurately identify the type of
amino acids, suggesting the lack of ability of conventional GNN models to capture 3D geometric
information. 3D-CNN performs better due to the power of the voxelization technique. Our models

7

a).b).Under review as a conference paper at ICLR 2023

outperform other models, suggesting OA-GNNs could help represent protein substructure geome-
tries better.

Table 1: Results of different RES methods on ATOM3D.

Model

3D-CNN GCN GIN GAT GVP-GNN OA-GCN OA-GIN OA-GAT

Table 2: Ablation studies.
Model No DW No Int No Equi

Acc %

45.1

8.2

9.1

12.4

48.2

50.2

50.8

49.2

Acc %

47.3

47.7

33.0

5.3 COMPUTATIONAL PROTEIN DESIGN

Datasets. Computational Protein Design (CPD) predicts the native protein sequence of a given
backbone structure. Specifically, we focus on two databases: CATH 4.2 (Ingraham et al., 2019)
organizes proteins in a hierarchical structure (Orengo et al., 1997). Following prior works, there
are 18, 024 protein chains in the training set, 608 in the validation set, and 1, 120 in the test. TS50
dataset (Li et al., 2014) is a relatively old benchmark consisting of only 50 protein structures widely
used in biology communities. 1.

Metrics. Native Sequence Recovery Rate is adopted to evaluate the prediction performance, which
compares the predicted sequence with the ground truth sequence at each position and calculates
the proportion of the correctly recovered amino acids (Li et al., 2014). The perplexity score (Je-
linek et al., 1977) evaluates whether a model could assign a high likelihood to the test sequences
(Ingraham et al., 2019).
Table 3: Results of different CPD methods on the
CATH 4.2.

Table 4: Results of MQA models on CASP
11 stage 2.

Perplexity

↓

Single All

Recovery %

↑

Single All

Model

St-Transformer
St-GCN
St-GIN
St-GAT
GVP-GNN

OA-GCN
OA-GIN
OA-GAT

No DW
No Int
No Equi

Short

8.54
8.31
8.03
10.86
7.10

5.42
5.84
5.92

6.52
6.45
6.21

9.03
8.88
8.52
10.67
7.44

5.69
5.39
5.53

6.85
6.55
6.15
9.89
5.29

3.94
3.85
4.13

27.6
28.1
28.4
26.8
32.0

38.5
40.1
39.3

36.4
37.3
38.1
35.2
40.2

47.5
47.8
46.7

Short

28.3
28.4
27.7
26.2
32.1

39.6
38.8
37.5

36.7
37.2
36.9

Model

Average

r

VoroMQA 0.42
0.17
RWplus
0.43
SBROD
0.44
Proq3D
0.49
3DCNN
0.39
Ornate
0.30
DimeNet
GraphQA
0.48
GVP-GNN 0.58

ρ

0.41
0.19
0.41
0.43
0.39
0.37
0.35
0.40
0.33

↑

τ

0.29
0.13
0.29
0.30
0.27
0.26
0.28
0.42
0.46

Global

ρ

0.69
0.03
0.57
0.80
0.67
0.67
0.62
0.72
0.61

0.65
0.67
0.69

↑

τ

0.51
0.01
0.39
0.59
0.48
0.48
0.43
0.74
0.81

0.85
0.88
0.86

r

0.65
0.06
0.55
0.77
0.64
0.63
0.61
0.75
0.80

0.84
0.86
0.83

6.79
6.36
6.04

5.28
4.87
4.64

0.51
0.52
0.53
Table 5: Results of structure biology methods on the TS50.

OA-GCN
OA-GIN
OA-GAT

0.37
0.36
0.42

0.62
0.63
0.65

35.0
36.3
37.1

42.9
44.9
45.8

Model

Recv %

Rosetta

30.0

SPIN

30.3

ProteinSolver Wang’s

SPIN2

SBROF

ProDCoNN St-Trans

30.8

33.0

33.6

39.2

40.7

42.3

Model

DenseCPD GVP-GNN

OA-GCN

OA-GAT OA-GIN No DW

No Int

No Equi

Recv %

50.7

44.9

53.8

54.5

52.7

46.8

48.7

49.5

Baselines. For the CATH 4.2 dataset, we compare our models with other state-of-the-art models,
including GVP-GNN, Structured Transformer and Structured GNN (Ingraham et al., 2019). We
compare multiple machine learning approaches in the TS50 dataset, including 3D CNN-based meth-
ods (ProDConn (Zhang et al., 2020), DenseCPD (Qi & Zhang, 2020)), sequential models (Wang’s
model Wang et al. (2018), SPIN (Li et al., 2014), SPIN2 (O’Connell et al., 2018)) and GNN-based
method (Strokach et al., 2020). We also compare with classical statistic methods (Schaap et al.,
2001; Cheng et al., 2019).

Results. As shown in Table 3, our models achieve significant improvement over other methods on
the CATH dataset. This result also suggests that the the short-chain and single-chain subsets are
more challenging, which is consistent with the result in (Ingraham et al., 2019). As shown in Table
5, our models also gain superior performance. These results suggest that adopting OA-GNNs is a
more effective way of designing valid protein sequences.

5.4 MODEL QUALITY ASSESSMENT

Datasets. Model quality assessment (MQA) evaluates the quality of predicted protein structures
(Kwon et al., 2021). The goal is to fit a model approximating the numerical metric used to compare

1As there is no canonical training set for TS50, we follow prior methods to use protein sequences with less
than 30% similarity with the TS50 test set from the CATH training set for training (Jing et al., 2020; Qi &
Zhang, 2020)

8

Under review as a conference paper at ICLR 2023

the predicted 3D structure with the native 3D structure. For this task, We randomly split the targets
in CASP5-CASP10 (Moult et al., 2014) and sample 50 decoys for each target for generating the
training and validation sets and use the CASP11 stage 2 proteins as the test set to ensure no similar
structures are involved. In total, there are 508 proteins for training, 56 for validation, and 85 targets
with 150 decoys for the test.

Metrics. We regress the global GDT TS score (Zemla, 2003), which evaluates the quality of decoys.
We adopt the correlation between the predicted and real GDT TS values to measure the performance.
We use three statistical correlation metrics: Pearson’s correlation r, Spearman’s ρ, and Kendall’s τ .
We calculate the correlation for each target and average all the correlations over all the targets. We
also calculate the Global correlations by taking the union of all decoy sets without considering the
targets (Pag`es et al., 2019).

Baselines. VoroMQA (Olechnoviˇc & Venclovas, 2017) leverages potential model with protein
contact maps, while RWplus (Zhang & Zhang, 2010) relies on physical energy terms. SBROD
(Karasikov et al., 2019) uses hand-crafted features. Proq3D (Uziela et al., 2017) employs a FCNs
for regression. 3DCNN (Derevyanko et al., 2018) and Ornate (Pag`es et al., 2019) apply 3D CNNs
for extracting meaningful features. GraphQA (Baldassarre et al., 2021), DimeNet (Gasteiger et al.,
2019b) and GVP-GNN are the most similar models as ours which adopted GNN-based methods on
protein graphs.

Results. As shown in table 4, our models outperform other methods on both average and global
metrics except for Spearman’s correlation ρ where we achieve the second-best, demonstrating our
models can not only evaluate the quality for the same protein but also works well across different
proteins in a more general way.

5.5 ABLATION STUDIES

In the end, we conduct ablation experiments to study the contribution of different modules of our
model on the tasks of CPD (table 3, 5) and RES (table 2). More specifically, based on OA-GCN, we
replace all the directed weights with the regular linear layer with scalar weights (No DW), or remove
the Interaction Module (No Int), or break the equivariance by canceling coordinate transformations
in the step of message passing (No Equi).

In general, all three components of our model are important since removing each of them results
in a significant performance drop. According to the performance gain, the directed weights are the
most important module for the CPD task, as the orientational features are essential for the protein to
fold to a given structure. For Residue Identity, however, equivariance message passing is the most
important component, indicating the necessity of rotation equivariance in learning the representation
of local protein structures.

6 CONCLUSION

For the first time, we generalize the scalar weights in neural networks to 3D directed vectors for
better perceiving geometric features like orientations and angles, which are essential in learning rep-
resentations from protein 3D structures. Based on the directed weights ⃗W, we provide a toolbox
of operators as well as a ⃗W-Perceptron Unit encouraging efficient scalar-vector feature interac-
tions. We also enforce global SO(3)-equivariance on a message passing paradigm using the local
orientations naturally defined by the rigid property of each amino acid residue, which can be used
for designing more powerful networks. Our integrated Orientation-Aware Graph Neural Networks
achieve comparably better performances on multiple biological tasks in comparison with existing
state-of-the-art methods.

Limitations and future work. While our method shows better awareness to fine geometric details,
there remains a huge space for non-linearity designs upon geometric representations. In the future,
we will extend our framework to other 3D learning tasks like small molecules or point clouds by
learning local rotation transformations and using directed vector weights.

9

Under review as a conference paper at ICLR 2023

REFERENCES

Rebecca F Alford, Andrew Leaver-Fay, Jeliazko R Jeliazkov, Matthew J O’Meara, Frank P DiMaio,
Hahnbeom Park, Maxim V Shapovalov, P Douglas Renfrew, Vikram K Mulligan, Kalli Kappel,
et al. The rosetta all-atom energy function for macromolecular modeling and design. Journal of
chemical theory and computation, 13(6):3031–3048, 2017.

Ethan C Alley, Grigory Khimulya, Surojit Biswas, Mohammed AlQuraishi, and George M Church.
Unified rational protein engineering with sequence-based deep representation learning. Nature
methods, 16(12):1315–1322, 2019.

Afshine Amidi, Shervine Amidi, Dimitrios Vlachakis, Vasileios Megalooikonomou, Nikos Para-
gios, and Evangelia I Zacharaki. Enzynet: enzyme classification using 3d convolutional neural
networks on spatial representation. PeerJ, 6:e4750, 2018.

Brandon Anderson, Truong Son Hy, and Risi Kondor. Cormorant: Covariant molecular neural

networks. Advances in neural information processing systems, 32, 2019.

Nina M Antikainen and Stephen F Martin. Altering protein specificity: techniques and applications.

Bioorganic & medicinal chemistry, 13(8):2701–2716, 2005.

Minkyung Baek, Frank DiMaio, Ivan Anishchenko, Justas Dauparas, Sergey Ovchinnikov, Gyu Rie
Lee, Jue Wang, Qian Cong, Lisa N Kinch, R Dustin Schaeffer, et al. Accurate prediction of
protein structures and interactions using a three-track neural network. Science, 373(6557):871–
876, 2021.

Federico Baldassarre, David Men´endez Hurtado, Arne Elofsson, and Hossein Azizpour. Graphqa:
protein model quality assessment using graph convolutional networks. Bioinformatics, 37(3):
360–366, 2021.

Simon Batzner, Tess E Smidt, Lixin Sun, Jonathan P Mailoa, Mordechai Kornbluth, Nicola Molinari,
and Boris Kozinsky. Se (3)-equivariant graph neural networks for data-efficient and accurate
interatomic potentials. arXiv preprint arXiv:2101.03164, 2021.

Tristan Bepler and Bonnie Berger. Learning protein sequence embeddings using information from

structure. In International Conference on Learning Representations, 2018.

Helen M Berman, John Westbrook, Zukang Feng, Gary Gilliland, Talapady N Bhat, Helge Weissig,
Ilya N Shindyalov, and Philip E Bourne. The protein data bank. Nucleic acids research, 28(1):
235–242, 2000.

Yue Cao, Payel Das, Vijil Chenthamarakshan, Pin-Yu Chen, Igor Melnyk, and Yang Shen. Fold2seq:
A joint sequence (1d)-fold (3d) embedding-based generative model for protein design. In Inter-
national Conference on Machine Learning, pp. 1261–1271. PMLR, 2021.

Jianlin Cheng, Myong-Ho Choe, Arne Elofsson, Kun-Sop Han, Jie Hou, Ali HA Maghrabi, Liam J
McGuffin, David Men´endez-Hurtado, Kliment Olechnoviˇc, Torsten Schwede, et al. Estimation of
model accuracy in casp13. Proteins: Structure, Function, and Bioinformatics, 87(12):1361–1377,
2019.

Taco Cohen and Max Welling. Group equivariant convolutional networks. In International confer-

ence on machine learning, pp. 2990–2999. PMLR, 2016.

Congyue Deng, Or Litany, Yueqi Duan, Adrien Poulenard, Andrea Tagliasacchi, and Leonidas J
Guibas. Vector neurons: A general framework for so (3)-equivariant networks. In Proceedings of
the IEEE/CVF International Conference on Computer Vision, pp. 12200–12209, 2021.

Georgy Derevyanko, Sergei Grudinin, Yoshua Bengio, and Guillaume Lamoureux. Deep convolu-
tional networks for quality assessment of protein folds. Bioinformatics, 34(23):4046–4053, 2018.

Frederik Diehl.

Edge contraction pooling for graph neural networks.

arXiv preprint

arXiv:1905.10990, 2019.

10

Under review as a conference paper at ICLR 2023

Dina Duhovny, Ruth Nussinov, and Haim J Wolfson. Efficient unbound docking of rigid molecules.

In International workshop on algorithms in bioinformatics, pp. 185–200. Springer, 2002.

Stephan Eismann, Raphael JL Townshend, Nathaniel Thomas, Milind Jagota, Bowen Jing, and
Ron O Dror. Hierarchical, rotation-equivariant neural networks to select structural models of
protein complexes. Proteins: Structure, Function, and Bioinformatics, 89(5):493–501, 2021.

Ahmed Elnaggar, Michael Heinzinger, Christian Dallago, Ghalia Rihawi, Yu Wang, Llion Jones,
Tom Gibbs, Tamas Feher, Christoph Angerer, Martin Steinegger, et al. Prottrans: towards crack-
ing the language of life’s code through self-supervised deep learning and high performance com-
puting. arXiv preprint arXiv:2007.06225, 2020.

Alex M Fout. Protein interface prediction using graph convolutional networks. PhD thesis, Colorado

State University, 2017.

Fabian Fuchs, Daniel Worrall, Volker Fischer, and Max Welling. Se (3)-transformers: 3d roto-
translation equivariant attention networks. Advances in Neural Information Processing Systems,
33:1970–1981, 2020.

Pablo Gainza, Freyr Sverrisson, Frederico Monti, Emanuele Rodola, D Boscaini, MM Bronstein,
and BE Correia. Deciphering interaction fingerprints from protein molecular surfaces using geo-
metric deep learning. Nature Methods, 17(2):184–192, 2020.

Octavian-Eugen Ganea, Xinyuan Huang, Charlotte Bunne, Yatao Bian, Regina Barzilay, Tommi S
Jaakkola, and Andreas Krause. Independent se (3)-equivariant models for end-to-end rigid protein
docking. In International Conference on Learning Representations, 2021.

Hongyang Gao and Shuiwang Ji. Graph u-nets. In international conference on machine learning,

pp. 2083–2092. PMLR, 2019.

Johannes Gasteiger, Janek Groß, and Stephan G¨unnemann. Directional message passing for molec-

ular graphs. In International Conference on Learning Representations, 2019a.

Johannes Gasteiger, Janek Groß, and Stephan G¨unnemann. Directional message passing for molec-

ular graphs. In International Conference on Learning Representations, 2019b.

Vladimir Gligorijevi´c, P Douglas Renfrew, Tomasz Kosciolek, Julia Koehler Leman, Daniel Beren-
berg, Tommi Vatanen, Chris Chandler, Bryn C Taylor, Ian M Fisk, Hera Vlamakis, et al. Structure-
based protein function prediction using graph convolutional networks. Nature communications,
12(1):1–14, 2021.

Pedro Hermosilla, Marco Sch¨afer, Matej Lang, Gloria Fackelmann, Pere-Pau V´azquez, Barbora Ko-
zlikova, Michael Krone, Tobias Ritschel, and Timo Ropinski. Intrinsic-extrinsic convolution and
pooling for learning on 3d protein structures. In International Conference on Learning Represen-
tations, 2020.

Pedro Hermosilla Casajus, Marco Sch¨afer, Matej Lang, Gloria Fackelmann, Pere Pau V´azquez Alco-
cer, Barbora Kozlikov´a, Michael Krone, Tobias Ritschel, and Timo Ropinski. Intrinsic-extrinsic
convolution and pooling for learning on 3d protein structures. In International Conference on
Learning Representations, ICLR 2021: Vienna, Austria, May 04 2021, pp. 1–16. OpenReview.
net, 2021.

Jie Hou, Badri Adhikari, and Jianlin Cheng. Deepsf: deep convolutional neural network for mapping

protein sequences to folds. Bioinformatics, 34(8):1295–1303, 2018.

Ilia Igashov, Kliment Olechnoviˇc, Maria Kadukova, ˇCeslovas Venclovas, and Sergei Grudinin.
Vorocnn: deep convolutional neural network built on 3d voronoi tessellation of protein structures.
Bioinformatics, 37(16):2332–2339, 2021.

John Ingraham, Vikas Garg, Regina Barzilay, and Tommi Jaakkola. Generative models for graph-

based protein design. Advances in neural information processing systems, 32, 2019.

11

Under review as a conference paper at ICLR 2023

Justina Jankauskait˙e, Brian Jim´enez-Garc´ıa, Justas Dapk¯unas, Juan Fern´andez-Recio, and Iain H
Moal. Skempi 2.0: an updated benchmark of changes in protein–protein binding energy, kinetics
and thermodynamics upon mutation. Bioinformatics, 35(3):462–469, 2019.

Fred Jelinek, Robert L Mercer, Lalit R Bahl, and James K Baker. Perplexity—a measure of the
difficulty of speech recognition tasks. The Journal of the Acoustical Society of America, 62(S1):
S63–S63, 1977.

Shuiwang Ji, Wei Xu, Ming Yang, and Kai Yu. 3d convolutional neural networks for human action
IEEE transactions on pattern analysis and machine intelligence, 35(1):221–231,

recognition.
2012.

Bowen Jing, Stephan Eismann, Patricia Suriana, Raphael John Lamarre Townshend, and Ron Dror.
Learning from protein structure with geometric vector perceptrons. In International Conference
on Learning Representations, 2020.

Bowen Jing, Stephan Eismann, Pratham N Soni, and Ron O Dror. Equivariant graph neural networks

for 3d macromolecular structure. ICML 2021 CompBio Workshop, 2021.

John Jumper, Richard Evans, Alexander Pritzel, Tim Green, Michael Figurnov, Olaf Ronneberger,
Kathryn Tunyasuvunakool, Russ Bates, Augustin ˇZ´ıdek, Anna Potapenko, et al. Highly accurate
protein structure prediction with alphafold. Nature, 596(7873):583–589, 2021.

Morten K¨allberg, Haipeng Wang, Sheng Wang, Jian Peng, Zhiyong Wang, Hui Lu, and Jinbo Xu.
Template-based protein structure modeling using the raptorx web server. Nature protocols, 7(8):
1511–1522, 2012.

Mikhail Karasikov, Guillaume Pag`es, and Sergei Grudinin. Smooth orientation-dependent scoring
function for coarse-grained protein quality assessment. Bioinformatics, 35(16):2801–2808, 2019.

Jacob Devlin Ming-Wei Chang Kenton and Lee Kristina Toutanova. Bert: Pre-training of deep
bidirectional transformers for language understanding. In Proceedings of NAACL-HLT, pp. 4171–
4186, 2019.

Thomas N Kipf and Max Welling. Semi-supervised classification with graph convolutional net-

works. arXiv preprint arXiv:1609.02907, 2016.

Jonas K¨ohler, Leon Klein, and Frank No´e. Equivariant flows: exact likelihood generative learn-
ing for symmetric densities. In International Conference on Machine Learning, pp. 5361–5370.
PMLR, 2020.

Sohee Kwon, Jonghun Won, Andriy Kryshtafovych, and Chaok Seok. Assessment of protein model
structure accuracy estimation in casp14: Old and new challenges. Proteins: Structure, Function,
and Bioinformatics, 2021.

Fabrice Lef`evre, Marie-H´el`ene R´emy, and Jean-Michel Masson. Alanine-stretch scanning muta-
genesis: a simple and efficient method to probe protein structure and function. Nucleic acids
research, 25(2):447–448, 1997.

Bian Li, Yucheng T. Yang, John A. Capra, and Mark B. Gerstein. Predicting changes in protein ther-
modynamic stability upon point mutation with deep 3d convolutional neural networks. bioRxiv,
2020. doi: 10.1101/2020.02.28.959874.

Shuangli Li, Jingbo Zhou, Tong Xu, Liang Huang, Fan Wang, Haoyi Xiong, Weili Huang, Dejing
Dou, and Hui Xiong. Structure-aware interactive graph neural networks for the prediction of
protein-ligand binding affinity. In Proceedings of the 27th ACM SIGKDD Conference on Knowl-
edge Discovery & Data Mining, pp. 975–985, 2021.

Zhixiu Li, Yuedong Yang, Eshel Faraggi, Jian Zhan, and Yaoqi Zhou. Direct prediction of profiles
of sequences compatible with a protein structure by neural networks with fragment-based local
and energy-based nonlocal profiles. Proteins: Structure, Function, and Bioinformatics, 82(10):
2565–2573, 2014.

12

Under review as a conference paper at ICLR 2023

Yi Liu, Limei Wang, Meng Liu, Xuan Zhang, Bora Oztekin, and Shuiwang Ji. Spherical message

passing for 3d graph networks. 2021.

Jesper Lundstr¨om, Leszek Rychlewski, Janusz Bujnicki, and Arne Elofsson. Pcons: A neural-
network–based consensus predictor that improves fold recognition. Protein science, 10(11):2354–
2362, 2001.

Shitong Luo, Jiahan Li, Jiaqi Guan, Yufeng Su, Chaoran Cheng, Jian Peng, and Jianzhu Ma. Equiv-
ariant point cloud analysis via learning orientations for message passing. In Proceedings of the
IEEE/CVF Conference on Computer Vision and Pattern Recognition, pp. 18932–18941, 2022.

John Moult, Krzysztof Fidelis, Andriy Kryshtafovych, Torsten Schwede, and Anna Tramontano.
Critical assessment of methods of protein structure prediction (casp)—round x. Proteins: Struc-
ture, Function, and Bioinformatics, 82:1–6, 2014.

Alexey G Murzin, Steven E Brenner, Tim Hubbard, and Cyrus Chothia. Scop: a structural classifi-
cation of proteins database for the investigation of sequences and structures. Journal of molecular
biology, 247(4):536–540, 1995.

Vinod Nair and Geoffrey E Hinton. Rectified linear units improve restricted boltzmann machines.

In Icml, 2010.

David L Nelson, Albert L Lehninger, and Michael M Cox. Lehninger principles of biochemistry.

Macmillan, 2008.

James O’Connell, Zhixiu Li, Jack Hanson, Rhys Heffernan, James Lyons, Kuldip Paliwal, Abdollah
Dehzangi, Yuedong Yang, and Yaoqi Zhou. Spin2: Predicting sequence profiles from protein
structures using deep neural networks. Proteins: Structure, Function, and Bioinformatics, 86(6):
629–633, 2018.

Kliment Olechnoviˇc and ˇCeslovas Venclovas. Voromqa: Assessment of protein structure quality
using interatomic contact areas. Proteins: Structure, Function, and Bioinformatics, 85(6):1131–
1145, 2017.

Christine A Orengo, Alex D Michie, Susan Jones, David T Jones, Mark B Swindells, and Janet M
Thornton. Cath–a hierarchic classification of protein domain structures. Structure, 5(8):1093–
1109, 1997.

Guillaume Pag`es, Benoit Charmettant, and Sergei Grudinin. Protein model quality assessment using

3d oriented convolutional neural networks. Bioinformatics, 35(18):3313–3319, 2019.

Alioscia Petrelli and Luigi Di Stefano. On the repeatability of the local reference frame for partial
shape matching. In 2011 International Conference on Computer Vision, pp. 2244–2251. IEEE,
2011.

Yifei Qi and John ZH Zhang. Densecpd: improving the accuracy of neural-network-based compu-
tational protein sequence design with densenet. Journal of chemical information and modeling,
60(3):1245–1252, 2020.

Roshan Rao, Nicholas Bhattacharya, Neil Thomas, Yan Duan, Xi Chen, John Canny, Pieter Abbeel,
and Yun S Song. Evaluating protein transfer learning with tape. Advances in neural information
processing systems, 32:9689, 2019.

Carol A Rohl, Charlie EM Strauss, Kira MS Misura, and David Baker. Protein structure prediction

using rosetta. Methods in enzymology, 383:66–93, 2004.

Vıctor Garcia Satorras, Emiel Hoogeboom, and Max Welling. E (n) equivariant graph neural net-

works. In International conference on machine learning, pp. 9323–9332. PMLR, 2021.

Marcel G Schaap, Feike J Leij, and Martinus Th Van Genuchten. Rosetta: A computer program for
estimating soil hydraulic parameters with hierarchical pedotransfer functions. Journal of hydrol-
ogy, 251(3-4):163–176, 2001.

13

Under review as a conference paper at ICLR 2023

Kristof Sch¨utt, Pieter-Jan Kindermans, Huziel Enoc Sauceda Felix, Stefan Chmiela, Alexandre
Tkatchenko, and Klaus-Robert M¨uller. Schnet: A continuous-filter convolutional neural network
for modeling quantum interactions. Advances in neural information processing systems, 30, 2017.

Kristof Sch¨utt, Oliver Unke, and Michael Gastegger. Equivariant message passing for the prediction
of tensorial properties and molecular spectra. In International Conference on Machine Learning,
pp. 9377–9388. PMLR, 2021.

Alexandra Shulman-Peleg, Ruth Nussinov, and Haim J Wolfson. Recognition of functional sites in

protein structures. Journal of molecular biology, 339(3):607–633, 2004.

Nitish Srivastava, Geoffrey Hinton, Alex Krizhevsky, Ilya Sutskever, and Ruslan Salakhutdinov.
Dropout: a simple way to prevent neural networks from overfitting. The journal of machine
learning research, 15(1):1929–1958, 2014.

Nils Strodthoff, Patrick Wagner, Markus Wenzel, and Wojciech Samek. Udsmprot: universal deep

sequence models for protein classification. Bioinformatics, 36(8):2401–2409, 2020.

Alexey Strokach, David Becerra, Carles Corbi-Verge, Albert Perez-Riba, and Philip M Kim. Fast
and flexible protein design using deep graph neural networks. Cell Systems, 11(4):402–411, 2020.

Freyr Sverrisson, Jean Feydy, Bruno E Correia, and Michael M Bronstein. Fast end-to-end learning
on protein surfaces. In Proceedings of the IEEE/CVF Conference on Computer Vision and Pattern
Recognition, pp. 15272–15281, 2021.

Nathaniel Thomas, Tess Smidt, Steven Kearnes, Lusann Yang, Li Li, Kai Kohlhoff, and Patrick
Riley. Tensor field networks: Rotation-and translation-equivariant neural networks for 3d point
clouds. arXiv preprint arXiv:1802.08219, 2018.

Wen Torng and Russ B Altman. 3d deep convolutional neural networks for amino acid environment

similarity analysis. BMC bioinformatics, 18(1):1–23, 2017.

Raphael Townshend, Rishi Bedi, Patricia Suriana, and Ron Dror. End-to-end learning on 3d protein
structure for interface prediction. Advances in Neural Information Processing Systems, 32:15642–
15651, 2019.

Raphael John Lamarre Townshend, Martin V¨ogele, Patricia Adriana Suriana, Alexander Derry,
Alexander Powers, Yianni Laloudakis, Sidhika Balachandar, Bowen Jing, Brandon M Ander-
son, Stephan Eismann, et al. Atom3d: Tasks on molecules in three dimensions. In Thirty-fifth
Conference on Neural Information Processing Systems Datasets and Benchmarks Track, 2021.

Karolis Uziela, David Menendez Hurtado, Nanjiang Shu, Bj¨orn Wallner, and Arne Elofsson.
Proq3d: improved model quality assessments using deep learning. Bioinformatics, 33(10):1578–
1580, 2017.

Ashish Vaswani, Noam Shazeer, Niki Parmar, Jakob Uszkoreit, Llion Jones, Aidan N Gomez,
Łukasz Kaiser, and Illia Polosukhin. Attention is all you need. In Advances in neural information
processing systems, pp. 5998–6008, 2017.

AD Vecchio, A Deac, P Li`o, and P Veliˇckovi´c. Neural message passing for joint paratope-epitope

prediction. 2021.

Petar Veliˇckovi´c, Guillem Cucurull, Arantxa Casanova, Adriana Romero, Pietro Li`o, and Yoshua
Bengio. Graph attention networks. In International Conference on Learning Representations,
2018.

Donald Voet and Judith G Voet. Biochemistry. John Wiley & Sons, 2010.

Jingxue Wang, Huali Cao, John ZH Zhang, and Yifei Qi. Computational protein design with deep

learning neural networks. Scientific reports, 8(1):1–9, 2018.

Wei Wang, Yan Huang, Yizhou Wang, and Liang Wang. Generalized autoencoder: A neural network
In Proceedings of the IEEE conference on computer

framework for dimensionality reduction.
vision and pattern recognition workshops, pp. 490–497, 2014.

14

Under review as a conference paper at ICLR 2023

Xiao Wang, Sean T Flannery, and Daisuke Kihara. Protein docking model evaluation by graph

neural networks. Frontiers in Molecular Biosciences, 8:402, 2021.

Edwin C Webb et al. Enzyme nomenclature 1992. Recommendations of the Nomenclature Commit-
tee of the International Union of Biochemistry and Molecular Biology on the Nomenclature and
Classification of Enzymes. Academic Press, 1992.

Maurice Weiler, Mario Geiger, Max Welling, Wouter Boomsma, and Taco S Cohen. 3d steerable
cnns: Learning rotationally equivariant features in volumetric data. Advances in Neural Informa-
tion Processing Systems, 31, 2018.

Jinbo Xu and Bonnie Berger. Fast and accurate algorithms for protein side-chain packing. Journal

of the ACM (JACM), 53(4):533–557, 2006.

Keyulu Xu, Weihua Hu, Jure Leskovec, and Stefanie Jegelka. How powerful are graph neural

networks? In International Conference on Learning Representations, 2018.

Jiaqi Yang, Yang Xiao, and Zhiguo Cao. Toward the repeatability and robustness of the local refer-
ence frame for 3d shape matching: An evaluation. IEEE Transactions on Image Processing, 27
(8):3766–3781, 2018.

Zhitao Ying, Jiaxuan You, Christopher Morris, Xiang Ren, Will Hamilton, and Jure Leskovec. Hier-
archical graph representation learning with differentiable pooling. Advances in neural information
processing systems, 31, 2018.

Adam Zemla. Lga: a method for finding 3d similarities in protein structures. Nucleic acids research,

31(13):3370–3374, 2003.

Jian Zhang and Yang Zhang. A novel side-chain orientation dependent potential derived from
random-walk reference state for protein fold selection and structure prediction. PloS one, 5(10):
e15386, 2010.

Yuan Zhang, Yang Chen, Chenran Wang, Chun-Chao Lo, Xiuwen Liu, Wei Wu, and Jinfeng Zhang.
Prodconn: Protein design using a convolutional neural network. Proteins: Structure, Function,
and Bioinformatics, 88(7):819–829, 2020.

Dmitrii Zhemchuzhnikov, Ilia Igashov, and Sergei Grudinin. 6dcnn with roto-translational convolu-
tion filters for volumetric data processing. In Proceedings of the AAAI Conference on Artificial
Intelligence, volume 36, pp. 4707–4715, 2022.

15

Under review as a conference paper at ICLR 2023

A PROOF OF ROTATION EQUIVARIANCE

A function f taking a 3D vector x
matrix R
R3 is rotation equivariance by fulfilling:

3 on x leads to the same transformations of the output f (x). Formally, f : R3

R3 as input is rotation equivariance, if applying ant rotation
→

R3
×

∈

∈

R(f (x)) = f (Rx)

(25)

For notation consistency, we consider each row of the matrix to be an individual 3D vector and use
right-hand matrix multiplication here. When performing equivariant message passing on protein
graph for node i with local rotation matrix Oi, we first transform the vector representations of its
neighbors from global reference to its local reference, that is, for a particular neighbor node j with
3, apply our DWNN layers f , and transform the updated features back
vector feature Vj ∈
to the global reference. We set only one neighbor node uj for ui for simplicity.The updated vector
representation Vi for node i is

RC

(26)
If we apply a global rotation matrix R to all vectors in the global frame, the local rotation matrix Oi
will be transformed to O′

j = VjR, now the output V ′

i = OiR, and Vj to be V ′

i )]Oi

i is

Vi = [f (VjOT

×

V ′

i = [f (V ′

j O′T
i )]O′
i
= [f (VjRRTOT
i )]OiR
= [f (VjOT
i )]OiR

And if instead, we directly apply the rotation matrix to original output Vi, we got

i = [f (VjOT
V ′
= ViR

i )]OiR

(27)

(28)

(29)

(30)
(31)

In other words, rotating the input leads to the same transformations to output, so we can preserve
rotation equivariance for vector representations in this way. Note that scalar features remain invariant
when applying global rotation, so our message-passing paradigm with global and local coordinate
transformations is rotation equivariance.

B EXPERIMENT DETAILS

We represent a protein 3D structure as an attributed graph, with each node and edge attached with
scalar and vector features that are geometric-aware. We implement our DWNN in the equivariant
message passing manner, with 3 layer Directed Weight Perceptrons for all tasks.

B.1 PROTEIN FEATURES

In this paper, we use an attributed graph
) to represent the protein structure, where each
,
V
node corresponds to one particular amino acid in the protein with edges connecting its k-nearest
neighbors. Here we set k = 30. The node features
=j
are both multi-channel scalar-vector tuples with scalar features like distances and dihedral angles
and vector features like unit vectors representing particular orientations.

v1, .., vN }

and edge features

eij}i

= (

=

=

V

G

E

E

{

{

A node vi represents the i-th residue in the protein with scalar and vector features describing its
geometric and chemical properties if available. Therefore, a node in this graph may have multi-
R6 or R26, Vi ∈
channel scalar-vector tuples (si, Vi), si ∈
. Here
ψ, ω, ϕ
sin, cos
}
{
from its four backbone atom positions, Cαi
−

are dihedral angles computed

3 as its initial features.

• Scalar Feature. The

1, Ni, Cαi, Ni+1.

ψ, ω, ϕ
}
{

R3
×

} ◦ {

• Scalar Feature. A one-hot representation of residue if the identity is available.
• Vector Feature. The unit vectors in the directions of Cαi+1 −
• Vector Feature. The unit vector in the direction of Cβi−
directions.

Cαi and Cαi

−

Cαi corresponds to the side-chain

Cαi.

1 −

16

̸
Under review as a conference paper at ICLR 2023

The edge eij connecting the i-th residue and the j-th residue also has multi-channel scalar-vector
R1
tuples as its feature (sij, Vij), sij ∈

R34, Vij ∈

×

3

• Scalar Feature. The encoding of the distance

using 16 Gaussian radial basis

functions with centers spaced between 0 to 20 angstroms.

Cαj −
∥

Cαi∥

• Scalar Feature. The positional encoding of j

protein sequence.

i corresponding the relative position in the

−

• Scalar Feature: The contact signal describes if the two residues contact in the space,1 if

Cαj −

∥

Cαj∥ ≤

8 and 0 otherwise.

• Scalar Feature. The H-bond signal describes if there may be a H-bond between the two

nodes calculated by backbone distance.

• Vector Feature. The unit vector in the direction of Cαj −

Cαi.

B.2 MODEL DETAILS

Synthetic Task. We uniformly sample points on the sphere and the ratio of positive and negative
samples is 1:1. We consider the length of each vector as one channel scalar feature
R and the
3. The VNN and GVP models in this experiment
R1
vector itself as one channel vector feature
×
are set to 3 layers. And our DWP is only 1 layer, consisting 1 Directed Linear Module, 1 NonLinear
Module, and 1 Directed Interaction Module. We also train a 3-layer MLP by concatenating the
R4 as input. Specifically, the parameter
scalar and vector feature as a four-channel scalar feature
counts of VNN, GVP, MLP, DWP is 24,28,24 and 24. We use Binary CrossEntropy Loss for this
two-class classification task. For MLP, the scalar and vector features are concatenated along the
channel, which means the feature of each point is a vector in R4. For GVP and VNN, the input
scalar and vector are represented by separate neural network components.

∈

∈

∈

For all models we trained in the protein-related task, we use 128 scalar channels and 32 vector
channels for each node’s hidden representations, 64 scalar channels, and 16 vector channels for each
edge’s hidden representations. There is 4 message passing updations in implemented models, where
each passing layer consists of 3 stacked DWPs. In total there are about 2.9 million parameters of
our models.

CPD. We train our model in a BERT-style recovery target (Strokach et al., 2020), more specifically,
we dynamically mask 85% residues of the whole protein and let the model recover them using
structure information from its neighbors using CrossEntropy loss. During testing, we mask all the
residues and recover the whole protein sequence in one forward pass, we also try to iteratively
predict one residue per forwarding pass.

MQA. Because MQA is a regression task, we train our model using MSE loss. When testing, we
compute the different types of correlations between predicted scores and ground truth.

RES. Residue identity requires the model to classify the center residue from a local substructure
of the protein. We construct a subgraph of each local substructure according to Section B.1. To
guarantee equitable comparison, we retrain all the methods based on our protein graph from scratch.

B.3 TRAINING DETAILS

For the synthetic task, we train each model for 1000 epochs with a learning rate of 1e
the training loss for evaluation.

−

3 and plot

4 for MQA, a dropout rate of 10%
We train our models with learning rate 3e
(Srivastava et al., 2014), and Layernorm paradigm. We train all the models on NVIDIA Tesla V100
for 100 epochs for each task.

4 for CPD and 2e

−

−

Our model uses 4-layer message passing, where each message passing consists of 3-layer DWP. The
total model consists of about 2.9 million parameters.

17

Under review as a conference paper at ICLR 2023

B.4 BASELINE DETAILS

We obtain most of our baseline numerical results from other benchmark papers. But because some
models haven’t been evaluated on some of the datasets we used, we reimplement them following the
same model complexity and training hyperparameters as our models.

In the synthetic dataset, we download the source code from (Deng et al., 2021) and (Jing et al.,
2021), both of which use CrossEntropy loss. The number of parameters of VNN, GVP, MLP, and
DWP is 24, 28, 24, and 24, respectively.

For the RES task Table 1, we implement GCN, GIN, and GAT models, which are trained and
evaluated with the same settings as our models. Following the source code from (Townshend et al.,
2021; Jing et al., 2021), we also retrain 3D CNN and GVP-GNN. To make a fair comparison, we
keep the model complexity (e.g. hidden dimensions, layer numbers) and hyperparameters (epochs,
random seed) of these baselines the same as our models.

For the CPD task in Table 3, we report the result of St-Transformer from (Ingraham et al., 2019),
St-GCN, and GVP-GNN from (Jing et al., 2020). We modify the source code from Structed-
Transformer(Ingraham et al., 2019) to get the result of St-GAT and St-GIN by replacing the original
attention layer in the encoder and decoder module with Graph Attention Network and Graph Iso-
morphism Network. The hidden dimensions and layer numbers are kept the same as our models.
In Table 5, we adopt most of the results from (Jing et al., 2020) except running the St-Transformer
model on the TS50 dataset.

For MQA in Table 4, we merge the results of the same task from (Jing et al., 2020) and Structed-
Transformer (Ingraham et al., 2019). As GVP-GNN only reports three of six of our metrics, so we
reimplement GVP-GNN and DimeNet on our benchmark. Same as the above model, the hidden
dimensions and layer numbers are kept the same as our models.

For our ablation models, we concatenate scalar and vector features as input and replace all the
directed weights with the regular linear layer with scalar weights to get the No DW model. By
removing the Interaction Module lying in the final layer of each perceptron, we obtain the No Int
model. We also replace local frames with unity matrices to break the equivariance in the message
passing part (No equivariance).

In the FOLD and REACT tasks, Kipf et al. and Diehl et al. construct the input graph using the
protein’s contact map and use pair-wise distances of residues as edge features. Baldassarre et al. use
the spatial features including the dihedral angles, surface accessibility, and secondary structure type
of each residue’s node feature. They also use distances, sequence distances, and bond types for edge
features. Hermosilla et al. consider more fine-grained atom-level spatial information, e.g. covalent
radius, van der Waals radius, and atom mass, which leads to better performance. Gligorijevi et al.
refer to different types of contact maps and geometric distances for the input of GNN. All GNN and
CNN baselines make use of 3D information in proteins.

C ADDITIONAL RESULTS

C.1 MULTIPLE RUNS ON RES TASK

We conduct different runs on RES dataset for both baseline and our models. As shown in Table 6,
we report the mean and std results of each method across five different random seeds, our models
are still doing best among other methods and have stable, robust performance with few deviations.

Table 6: Results across five different random seeds of models on RES dataset (Mean ± Std).
GVP-GNN OA-GCN OA-GIN OA-GAT
Model
3D CNN
49.2±0.3
48.4±0.4
Acc % 45.0±0.4

GAT
12.4±0.2

GIN
9.2±0.5

GCN
8.2±0.3

50.2±0.2

50.8±0.1

C.2

ITERATIVE PREDICTION ON CPD TASK

We tested the sequential decoding of the prediction from the N-side to the C-side and reported the
native sequence recovery as shown in Table 7,

18

Under review as a conference paper at ICLR 2023

Table 7: Iterative prediction results of our models on both CATH (Short, Single, All) and TS50
dataset.

Model
OA-GCN (iter)
OA-GIN (iter)
OA-GAT (iter)

Short
34.1
34.4
36.0

Single
35.7
37.2
36.5

All
45.3
45.7
36.5

TS50
50.9
52.2
49.6

The results have shown that the sequential decoding approach basically caused a degradation of the
results, but because we introduced the directed weight and geometric operations, our results are still
better than other benchmarks. We have added these results in the supplementary material.

C.3 PROTEIN FUNCTION CLASSIFICATION

Datasets. Fold Classification (FOLD) predicts the structure category of a given protein structure.
We choose the SCOP v1.75 dataset collected by Murzin et al. (1995) that organizes structures into
3-layer hierarchical classes. In total, there are 16, 712 proteins covering 7 major structural types with
1, 195 identified folds. We adopt a reduced dataset from Hou et al. (2018), and remove homologous
sequences between test and training data sets at Family (Fam), Superfamily (Sup) or Fold levels,
resulting in three different classification tasks.

The Enzyme-Catalyzed Reaction Classification (REACT) study is a very similar task as it requires
to classify the EC number Webb et al. (1992) of a catalyzed enzyme based on the protein structures.
Therefore, we put these two tasks side-by-side to evaluate the performance of different methods.
We use the dataset collected by (Hermosilla Casajus et al., 2021), containing 37, 428 proteins from
384 types of Enzyme-Catalyzed classes and we split them into training, validation set, test set and
ensure no sequence or structure overlaps across different sets. In total, there are 29, 215 structures
for training, 2, 562 for validation, and 5, 651 for test.

Metrics. Following standard benchmarks Diehl (2019); Hermosilla Casajus et al. (2021), we use
the classification accuracy for evaluating the prediction performance.

Baselines. We compare with CNN-based models and GNN-based models which learn the protein
annotations using 3D structures from scratch. For fair comparison, we also do not include LSTM-
based or transformer-based methods, as they all pre-train their models using millions of protein
sequences and only fine-tune their models on 3D structures Bepler & Berger (2018); Alley et al.
(2019); Rao et al. (2019); Strodthoff et al. (2020); Elnaggar et al. (2020).

Results. As shown in Table 8, our models demonstrate comparable prediction performance in both
tasks across different levels of the hierarchy. Classifying the fold and enzyme classes based on the
protein structure is one of the key problems in structural biology and our proposed models can be
used as new tools to conduct function annotations for new proteins.

For FOLD and REACT tasks, all GNN-based baselines use 3D structure information:

• Kipf & Welling (2016) and Diehl (2019) construct the input graph using the protein’s con-

tact map and use pair-wise distances of residues as edge features.

• Baldassarre et al. (2021) use the spatial features including the dihedral angles, surface
accessibility, and secondary structure type of each residue’s node feature. They also use
distances, sequence distances, and bond types for edge features.

• Hermosilla Casajus et al. (2021) consider more fine-grained atom-level spatial informa-
tion, e.g. covalent radius, van der Waals radius, and atom mass, which leads to better
performance.

• Gligorijevi´c et al. (2021) refer to different types of contact maps and geometric distances

for the input of GNN.

Despite not using special training techniques, pre-training tasks, and fine-tuning of hyperparameters,
our models demonstrate comparable prediction performance in both tasks across different levels of
the hierarchy. Especially with the introduction of our directed weight with equivariant message
passing, it is a big improvement over the normal GNN.

19

Under review as a conference paper at ICLR 2023

Table 8: Results on Fold and React classification

Architecture

FOLD

REACT

Fold

Sup

Fam

Hou et al. (2018)
Derevyanko et al. (2018)

1D ResNet
3D CNN

17.0% 31.0% 77.0% 70.9%
31.6% 45.4% 92.5% 78.8%

Kipf & Welling (2016)
Diehl (2019)
Hermosilla Casajus et al. (2021)
Baldassarre et al. (2021)
Gligorijevi´c et al. (2021)

GCN
GCN
GCN
GCN

16.8% 21.3% 82.8% 67.3%
12.9% 16.3% 72.5% 57.9%
45.0% 69.7% 98.9% 87.2%
23.7% 32.5% 84.4% 60.8%
LSTM+GCN 15.3% 20.6% 73.2% 63.3%

Our method
Our method
Our method

OA-GCN
OA-GIN
OA-GAT

31.2% 39.8% 84.8% 76.0%
32.8% 38.3% 85.2% 76.7%
29.9% 36.6% 79.0% 77.2%

D COMPARISONS TO PRIOR WORKS

D.1 COMPARISON TO ANGULAR-EXPLICIT MODELS

There are several works that explicitly model angles/torsion angles in GNNs. DimeNet(Gasteiger
et al., 2019b) uses physical-informed RBF and SBF functions to represent distances and angular
information. SphereNet Liu et al. (2021) further employs a 3D meaningful spherical coordinate
system to represent molecular torsional angles. However, these methods rely on invariant scalar
input features for remaining equivariance, and during convolution, these scalar features (distances,
angles) are just used for updating hidden representations and stay the same in the next layer updating.

On the technical level, our model also has several differences from other methods when compared
with existing studies to consider backbone torsion angles (DimeNet, SpehreNet, etc.), as follows:

1. RBF-embedded distances and Trigonometric-embedded angles are adopted in the input fea-
ture engineering part (see supplementary material). To better represent the 3D geometries,
we also introduce several normal vectors as input node features and edge characteristics.
The scalar representations are invariant and vectors are equivariant. But these methods
don’t consider vector representations and only focus on invariant scalar features.

2. We capture fine-grained geometries with the help of vector representations and directed
weight perceptrons. And representations are updated layer-by-layer. Our directed weights
are learnable to be expandable for complex reasoning capabilities. But these methods only
embed angles and distances into edge features during message updating and lack geometry
meaningful operations. They also don’t have directed weights, which are key contributions
to our work.

3. We maintain equivariance with the help of local coordinate transformations on vector rep-
resentations equipped with rigid residue positions. But these methods don’t consider equiv-
ariant vectors, they only condition on invariant scalars. SphereNet does use local spherical
systems, but they are used for calculating relative locations of atoms, seen as a feature
engineering part.

4. We aim to design a new type of vector neurons for geometric learning and a general mes-
sage passing paradigm for 3D graphs. We have shown our versatility in any existing graph
learning frameworks. However, these methods are designed specifically for molecular
graphs and are hard to extend for other 3D point sets.

D.2 COMPARISON TO OTHER EGNN WORKS

Local-global frame transformation is an important technique for 3D object learning (Petrelli &
Di Stefano, 2011; Yang et al., 2018; Luo et al., 2022) and is inevitable in the discussions of 3D

20

Under review as a conference paper at ICLR 2023

equivariance. Our proposed framework focuses on its computation in the latent space together with
our vector-based feature representations, while many existing works only apply rotations to the
primal space of explicit geometric/physical properties (e.g. simple cartesian coordinates). It also
provides better flexibility over message-passing operators by eliminating the requirements for spe-
cific feature-update arithmetics – this also serves as an adaptor for plugging our designed feature
representations into many existing GNN models while guaranteeing equivariance.

Among the EGNNs, we could not agree that our model is a simplified model from others. Specif-
ically, some of these EGNNs could be considered a special case of our framework. For instance,
E(n) GNN (Satorras et al., 2021) combines node coordinates weighted by hidden representations,
which could be recognized as linearly updating of simple vector features (coordinate) and unit ma-
trix transformations (in analogy to our back and forth transformations).

Additionally, to the best of our knowledge, there is no previous work that integrates vector-based
features and directed weighted neural networks into local-global transformation frameworks. We ap-
ply transformations on hidden scalar-vector features back and forth for better representations under
equivariance, which turns out to show decent performances in the protein learning tasks.

D.3 COMPARISON TO OTHER BACKBONE-ORIENTATION MODELS

Using sin, cos . . . ϕ, ψ, ω as features are popular techniques in protein learning tasks (Ingraham
et al., 2019; Jing et al., 2021; Ganea et al., 2021), but our models can have a more powerful ability to
make use of these features. The meaning of Orientation-Aware GNNs is not to use torsional angles
as the node and edge features, but for reasoning on them. Our real contribution is to design a new
type of neural network, which has good capability in sensing these geometric features (e.g. angles,
orientations) as well as capturing complex interactions. The synthetic experiment gives an intuitive
example of our claims, where our designed directed weight perceptrons have more powerful in sens-
ing and handling angular-related characteristics. Here we share an even simpler example: Assume
the input contains two 3D vectors v1 and v2 described by their coordinates [x1, y1, z1, x2, y2, z2],
the problem we solved is that how should we let the model know the angle between v1 and v2. The
most straightforward intuition is that if the weights are directed vectors, then we could count on the
inner products between weights and input vectors to capture the angle information. Furthermore,
if one wants to retrieve more complex geometric objects, e.g. normal vectors, dihedral angles, or
parallel surfaces based on input coordinates, our employed cross-product operation can easily solve
that. As we use scalar-vector tuple hidden representations for nodes and edges, and directed weights
with geometric-meaningful operators are learnable, our models could perform more complex geo-
metric reasoning ability and modeling capability beyond angles, especially approximating nonlinear
functions on vector representations.

The most straightforward intuition is that if the weights are directed vectors, then we could count on
the inner products between weights and input vectors to capture the angle information. Furthermore,
if one wants to retrieve more complex geometric objects, e.g. normal vectors, dihedral angles, or
parallel surfaces based on input coordinates, our employed cross-product operation can easily solve
that. As we use scalar-vector tuple hidden representations for nodes and edges, and directed weights
with geometric-meaningful operators are learnable, our models could perform more complex geo-
metric reasoning ability and modeling capability beyond angles, especially approximating nonlinear
functions on vector representations.

The motivation and function of residue orientations are also different from prior works. Instead of
using the angles (orientations) as input features, residue backbone orientations define the coordinate
frame of the whole system and are used in the equivariant message passing part for coordinate trans-
formation. Rigid orientations play the role of bridging local and global coordinates for equivariance
in our message passing part.

21

Under review as a conference paper at ICLR 2023

E EXPLANATIONS TO SOME MODULES

E.1 ABOUT THE s′dot

For the s′dotfeatures, it can be interpreted as the summation of the channel-wise dot product be-
tween the input features (channels of vectors) and the directed weights (a matrix of vectors, so a
3-dimensional tensor). Let us consider the i-th number in the output feature, it can be formulated as:

s′i =

(cid:88)

jk

W ijkvjk =

(wij)T vj

(cid:88)

j

Notice that both are 3D vectors, **the dot product can essentially reflect the cosine value between
them after normalization**. Essentially, our method utilizes the dot product operation between the
directed weights and the input coordinate features, and more importantly, the weight vectors are
learnable. We also recommend you pay attention to other operations we introduced for reasoning
in complex geometric relations and encouraging efficient scalar-vector feature interactions. For
instance, the cross-product operation can create new orthogonal orientations; the interaction modules
can facilitate feature blending.

E.2 ABOUT THE SCALR-LIFTING PART

The initial motivation of scalar lifting is to enable scalar-vector interactions, which are not well
addressed in previous works (for instance, VNN (Deng et al., 2021) and GVP (Jing et al., 2020) can
only perform vector-to-scalar mappings with a very limited choice of operations). Unprojecting from
lower dimensions to higher dimensions is indeed non-bijective on the test data themselves, but it is
a widely adopted approach like the diluted convolution or the transposed convolution that succeeds
in the projection onto higher dimensional features. Mapping from high dimensions to lower space
and then projecting back is also a popular technique in FCNs (Kenton & Toutanova, 2019; Jumper
et al., 2021), Generative Models (Wang et al., 2014), and Manifold Learning, which can be regarded
as feature compression and information bottleneck. Therefore, though not unique, the learnable
directed weights endow the model with the expressiveness to recover useful information hopefully
after training on many data. More intuitively, the scalar lifting operator generates fixed directional
vectors with different lengths during inference, which can potentially provide more information
during the next round of feature processing and facilitate information flow between scalar and vector
features.

The scalar lifting module serves to pass scalar information to the vector representation in our model.
Though we give a geometric interpretation of the intuition, our directed weight is learnable, the
operation of the model is complex and its final geometric meaning is non-linear, which is difficult to
define simply. The function of the mapping is learned according to the needs of the downstream task
and is not limited to reconstruction or compression. From the experimental results, the network we
designed does achieve excellent performance, demonstrating our strong geometric perception and
representation capabilities.

22

